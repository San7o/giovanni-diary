<?xml version="1.0" encoding="utf-8"?><rss version="2.0"><channel>
<title>Giovanni's Diary Programming</title>
<link>giovanni-diary.netlify.com/programming/programming.html</link>
<description><![CDATA[Giovanni's programmer diary.]]></description>
<item>
<title>Benchmarking on Linux</title>
<link>https://giovanni-diary.netlify.app/programming/linux/benchmarking-on-linux.html</link>
<author>Giovanni Santini</author>
<pubDate>24 May 2025 00:00:00 GMT</pubDate>
<description><![CDATA[<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org6cc5286">1. Overview</a></li>
<li><a href="#orga6d456c">2. Command line usage</a></li>
<li><a href="#org3a7da4e">3. openbenchmarking.org</a></li>
<li><a href="#orgaa5cc87">4. Phoromatic server</a></li>
</ul>
</div>
</div>
<p>
Running benchmarks is ultimately the best way to compare two different
systems or to assert that a particular modification has had any
positive or negative effect on the system's performance. To do
benchmarks I have been using the <a href="https://github.com/phoronix-test-suite/phoronix-test-suite">phoronix test suite</a>, in this document
I will briefly explain what phoronix is and how It works.
</p>

<div id="outline-container-org6cc5286" class="outline-2">
<h2 id="org6cc5286"><span class="section-number-2">1.</span> Overview</h2>
<div class="outline-text-2" id="text-1">
<p>
Phoronix is the name of a famous <a href="https://www.phoronix.com/">website</a> founded by Michael Larabel in
2004 where Michael has been publishing benchmarks and news of linux
applications for the most part. I personally think his website is one
of the most reliable sources of information regarding performance and
news on latest software and hardware. Michael has also create his
testing framework, the Phoronix Test Suite, which he uses for all his
benchmarks.
</p>

<p>
The Phoronix Test Suite is composed of an <a href="https://openbenchmarking.org/tests">immense number of benchmarks</a>
supporting many operating systems including Linux, Windows, maxOS,
Solaris and various BSD. Around this tool there is a community of
people creating new tests and sharing results in the
<a href="https://openbenchmarking.org/results/latest">openbenchmarking.org</a> website. Here, anybody can view and compare them
via the web interface. Furthermore, you can schedule and run your
custom test suites on multiple machines and visualize results in nice
graphs of various kinds.
</p>
</div>
</div>

<div id="outline-container-orga6d456c" class="outline-2">
<h2 id="orga6d456c"><span class="section-number-2">2.</span> Command line usage</h2>
<div class="outline-text-2" id="text-2">
<p>
You can download the phoronix test suite from the official <a href="https://github.com/phoronix-test-suite/phoronix-test-suite">github</a>
page, or through you favorite package manager. Fedora provides the
package "phoronix-test-suite-$VERSION". Running the command will give
you a bunch of possible flags you can enter.
</p>

<div class="org-src-container">
<pre class="src src-bash">phoronix-test-suite help
</pre>
</div>

<p>
For the most basic usage, you may want to select and run a test. Let's
first list all the available tests:
</p>

<div class="org-src-container">
<pre class="src src-bash">phoronix-test-suite list-all-tests
</pre>
</div>

<p>
Let's pick for example "pts/unpack-linux", a popular test to unpack the
linux kernel. To get more information about a single test, run:
</p>

<div class="org-src-container">
<pre class="src src-bash">phoronix-test-suite info pts/unpack-linux
</pre>
</div>

<p>
Some tests may depend on some programs which you need to have
installed in your system, those programs are usually listed under the
"Software Dependencies" voice on the infos.
</p>

<p>
Let's try to run the test now. Note that the tests are lazily fetched
meaning that you don't have all the tests downloaded in you system but
you decide which one to download. When running a test it automatically
gets downloaded.
</p>

<div class="org-src-container">
<pre class="src src-bash">phoronix-test-suite test pts/unpack-linux
</pre>
</div>

<p>
The program will ask if you want to save the results to a file, and to
give an unique name for the test. The test will start running, often
multiple times. After completion, you are asked if you want to view
the results on a web page, otherwise you will be able to do so from
the command line by starting the result viewer:
</p>

<div class="org-src-container">
<pre class="src src-bash">phoronix-test-suite start-result-viewer
</pre>
</div>

<p>
From here you get a web page where you can explore the results,
compare them and export them in various formats such as pdf, html,
json etc..
</p>
</div>
</div>

<div id="outline-container-org3a7da4e" class="outline-2">
<h2 id="org3a7da4e"><span class="section-number-2">3.</span> openbenchmarking.org</h2>
<div class="outline-text-2" id="text-3">
<p>
You can view other people's benchmarks and tests on
<a href="https://openbenchmarking.org/">openbenchmarking.org</a>. It is particularly useful to download or compare
the results directly through the browser by writing a comma separated
list of the IDs of the benchmarks you want to compare on the url. It
is easier to see with an example, the request with the following url
will compare the results between the test "2505249-NE-RES42653018" and
"2505242-NE-RES51774018", where each ID was generated when uploading a
result to the website:
</p>

<pre class="example">
https://openbenchmarking.org/result/2505249-NE-RES42653018,2505242-NE-RES51774018
</pre>

<p>
The website is also useful to look for specific tests and their
results over various systems averaged by all the tests from the
community. You can find this information in the <a href="https://openbenchmarking.org/tests">tests</a> page.
</p>


<div id="org75a7a27" class="figure">
<p><img src="../../ephemeris/images/openbenchmarking.png" alt="openbenchmarking.png" width="600px" align="center" />
</p>
<p><span class="figure-number">Figure 1: </span>A test on openbenchmarking.com</p>
</div>
</div>
</div>

<div id="outline-container-orgaa5cc87" class="outline-2">
<h2 id="orgaa5cc87"><span class="section-number-2">4.</span> Phoromatic server</h2>
<div class="outline-text-2" id="text-4">
<p>
The coolest think about phoronix in my opinion is the
phoromatic-server. Using the same program we have been using to run
the tests, we can host a server using:
</p>

<div class="org-src-container">
<pre class="src src-bash">phoronix-test-suite start-phoromatic-server
</pre>
</div>

<p>
This will start a web interface where you can remotely manage
benchmarks on multiple machines. When you first open the web page,
you can login or create an account (locally), then you will get an
overview page with the state of the various machines you have
connected and which benchmarks are running or are scheduled to run.
</p>

<p>
From the "systems" page you can manage your machines. You will get
a list of the connected machines with a description of their hardware
and software. The page contains instructions to connect other machines,
which looks like running a command similar to:
</p>

<div class="org-src-container">
<pre class="src src-bash">phoronix-test-suite phoromatic.connect 10.10.100.1:8484/VA9KRR
</pre>
</div>

<p>
From the "test" page you can browse tests, and from the "testing"
page you can schedule them. You usually need to create a custom
test suite which is just a collection of one or more tests to run. You
can then run the suite and see the results in the "results" page.
</p>

<p>
Even if the user interface does not look pretty, phoronix is a really
powerful tool that does the job done. There are many more
functionalities and I think It is worth the time to learn and explore
what the tool is able to do.
</p>

<hr />

<p>
Travel: <a href="./notes.html">Linux Notes</a>, <a href="../../theindex.html">Index</a>
</p>
</div>
</div>
]]></description>
</item>
<item>
<title>The Linux From Scratch Experience</title>
<link>https://giovanni-diary.netlify.app/programming/linux/linux-from-scratch.html</link>
<author>Giovanni Santini</author>
<pubDate>23 Apr 2025 00:00:00 GMT</pubDate>
<description><![CDATA[<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org5096e2c">1. Index</a></li>
<li><a href="#orgcd0c3b2">2. What is LFS</a></li>
<li><a href="#orgd414345">3. Motivation</a></li>
<li><a href="#org8128076">4. Humble beginnings</a></li>
<li><a href="#org3089975">5. Level up</a></li>
<li><a href="#org533e353">6. Maintaining the build</a></li>
</ul>
</div>
</div>
<p>
In this article I want to talk about one of the best educational
projects I have ever done: Linux From Scratch.
</p>

<p>
The Linux From Scratch experience is a hell of a long and boring
ride into manual dependency management, patching build scripts,
kernel panics, and a lot of time spent compiling. But as
hard times develop one's character, running LFS daily will strengthen
your patience and make you a competent power user.
</p>

<p>
Jokes aside, this project made me appreciate more the work of package
management and understand all the different parts of Linux's
userspace. I learned how to fearlessly own the kernel or get owned
and totally humiliated by the same technology you utter human being
wrote. It gave me experience in working directly with the core
userspace technologies, cutting down on high abstractions and
pre-configured linux distributions by making my own "distribution".
</p>


<div id="outline-container-org5096e2c" class="outline-2">
<h2 id="org5096e2c"><span class="section-number-2">1.</span> Index</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>What is LFS</li>
<li>Motivation</li>
<li>Humble beginnings</li>
<li>Level up</li>
<li>Maintaining the build</li>
</ul>
</div>
</div>

<div id="outline-container-orgcd0c3b2" class="outline-2">
<h2 id="orgcd0c3b2"><span class="section-number-2">2.</span> What is LFS</h2>
<div class="outline-text-2" id="text-2">
<p>
The idea is that you compile all your system from scratch by yourself,
without a packet manager. This is what distinguishes LFS from a
project like Gentoo, where it is true that you compile everything from
scratch but all the steps were already prepared and you just execute
them.
</p>

<p>
Practically, LFS is a manual with instructions to compile a bootable
system. This is expanded in Beyond Linux From Scratch (BLFS) which
adds additional programs like a graphics session or a browser.
</p>
</div>
</div>

<div id="outline-container-orgd414345" class="outline-2">
<h2 id="orgd414345"><span class="section-number-2">3.</span> Motivation</h2>
<div class="outline-text-2" id="text-3">
<p>
It all started at the end of October 2024. I was really frustrated
with NixOS because of how you need to do everything "then NixOS
way". I could not play and mess with the system as if I were in a
cage, I needed a change of mindset. With this push for freedom and
independence, I wanted to get to the extreme and try Linux From
Scratch which I have had in the back of my mind for a while.
</p>

<p>
Furthermore, I believed in the educational value of this project.
I already felt comfortable installing Archlinux or Gentoo and I
wanted something more challenging.
</p>
</div>
</div>

<div id="outline-container-org8128076" class="outline-2">
<h2 id="org8128076"><span class="section-number-2">4.</span> Humble beginnings</h2>
<div class="outline-text-2" id="text-4">
<p>
You start off as with any distribution by setting up the partitions
from a live environment. Then, you start compiling your compiler, gcc,
which is done in three steps. This is because to compile the compiler
you need a compiler&#x2026; duh. So you use an external one to compile a very
tiny gcc, which is used to compile a very tiny glibc, which is needed
for a better gcc, and again another time. Once you have gcc and glibc
you can really get started.
</p>

<p>
You proceed to install all the useful programs that you always find
like gnutils, dhcp, the boot manager (I did grub with UEFI) and of
course the Linux kernel. It takes special care for the kernel because
if you start with a minimal kernel, you need to manually enable all
the features you need to interface with the various devices, and It is
not always obvious which option you need to enable.
</p>

<p>
After all of this, you have a bootable kernel, congratulations.  You
just spent a week of your life to have a minimal system barely usable.
</p>

<p>
Now the real experience begins.
</p>
</div>
</div>

<div id="outline-container-org3089975" class="outline-2">
<h2 id="org3089975"><span class="section-number-2">5.</span> Level up</h2>
<div class="outline-text-2" id="text-5">
<p>
One big thing you probably need is a graphical session, and this is no
joke. Compiling all the dependencies for i3 took a while, but
eventually I had it. The next thing is what transitioned my system to
the next level.. a web browser (DUN DUN DUUUN).
</p>

<p>
Compiling firefox has so many dependencies, especially if you
want all the optional ones, just to make sure it works. In my
list of installed programs, firefox is at the 300th line. This
means that I compiled a total of 299 libraries / programs before
I could use firefox. All of this manually.
</p>

<p>
Once you have a browser you are good to go on your own. The book
does not help you much anymore and you developed the skills to
build everything without a guide. Only after all those weeks of
hard work you can start using your system "normally".
</p>

<p>
Obviously every time you need to install something, you think
twice if you really really need It of if It is just a short term
desire that will not greatly improve your life.
</p>
</div>
</div>

<div id="outline-container-org533e353" class="outline-2">
<h2 id="org533e353"><span class="section-number-2">6.</span> Maintaining the build</h2>
<div class="outline-text-2" id="text-6">
<p>
You can now focus on maintaining your system. You should subscribe to
some security updates mailing lists and update programs when some
critical vulnerability is found or a new version of some important
software comes out. I was following compilers like llvm, gcc, core
libraries like SDL, programs I use everyday like firefox and emacs,
and some more.
</p>

<p>
To make my life easier, I maintained a list of all the installed
programs with their version. I wrote a little package manager
called <a href="https://github.com/San7o/mapkg">mapkg</a> but I never fully committed to It. I kept a backup
of all the configuration files in a github <a href="https://github.com/San7o/lfs">repo</a>.
</p>

<p>
I kept this build for about 3-4 months, the I got bored and
installed Fedora because It was too much to make everything work.
Still, I will probably get back into it, It will surely be easier
with all the experience I gained.
</p>

<hr />

<p>
Travel: <a href="./notes.html">Linux Notes</a>, <a href="../../theindex.html">Index</a>
</p>
</div>
</div>
]]></description>
</item>
<item>
<title>Monitor your Linux system with Prometheus and Grafana</title>
<link>https://giovanni-diary.netlify.app/programming/linux/linux-monitoring-with-prometheus-and-grafana.html</link>
<author>Giovanni Santini</author>
<pubDate>24 May 2025 00:00:00 GMT</pubDate>
<description><![CDATA[<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orged65d2c">1. Index</a></li>
<li><a href="#org62b774a">2. Setting up node exporter</a></li>
<li><a href="#orgf5bdd66">3. Setting up Prometheus</a></li>
<li><a href="#org4fd340e">4. Setting up Grafana</a></li>
<li><a href="#org4ca5580">5. Custom Exporter</a></li>
</ul>
</div>
</div>
<p>
If you are managing any system, you need to have an effective way to
monitor, log and receive notifications about the state of the system.
A classic solution for Linux based servers is the Prometheus +
Grafana stack. In this document I will explain you how to setup this
and how to create a custom prometheus exporter.
</p>

<p>
We will see how to setup both Prometheus and Grafana to monitor
various system statistics which are fetched by node exporter. I will
be using Fedora 42 as a base.
</p>

<div id="outline-container-orged65d2c" class="outline-2">
<h2 id="orged65d2c"><span class="section-number-2">1.</span> Index</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>Setting up node exporter</li>
<li>Setting up Prometheus</li>
<li>Setting up Grafana</li>
<li>Custom exporter</li>
</ul>
</div>
</div>

<div id="outline-container-org62b774a" class="outline-2">
<h2 id="org62b774a"><span class="section-number-2">2.</span> Setting up node exporter</h2>
<div class="outline-text-2" id="text-2">
<p>
Node exporter is a service that collects various system information
such as CPU load, ram usage and much more. Fedora already provides the
package "node-exporter" and service "node [underscore] exporter":
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo dnf install node-exporter
sudo systemctl start node_exporter
</pre>
</div>

<p>
The service will listen on port 9100.
</p>
</div>
</div>

<div id="outline-container-orgf5bdd66" class="outline-2">
<h2 id="orgf5bdd66"><span class="section-number-2">3.</span> Setting up Prometheus</h2>
<div class="outline-text-2" id="text-3">
<p>
You can download the latest version of Prometheus from GitHub:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #eedd82;">LATEST</span>=$(curl -s https://api.github.com/repos/prometheus/prometheus/releases/latest | jq -cr .tag_name)
wget https://github.com/prometheus/prometheus/releases/download/$<span style="color: #eedd82;">LATEST</span>/prometheus-<span style="color: #ffa07a;">"${LATEST:1}"</span>.linux-amd64.tar.gz
tar -xf prometheus-*
<span style="color: #b0c4de;">cd</span> prometheus-<span style="color: #ffa07a;">"${LATEST:1}"</span>.linux-amd64
sudo cp prometheus /usr/local/bin/
</pre>
</div>

<p>
You need to add node exporter to the list of services to scrape, you
should edit the <code>/etc/prometheus/prometheus.yml</code> file and add the
following Item in the "scrape configs" section:
</p>

<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #eedd82;">scrape_configs</span>:
  - <span style="color: #eedd82;">job_name</span>: <span style="color: #ffa07a;">'linux-server'</span>
    <span style="color: #eedd82;">scrape_interval</span>: 5s
    <span style="color: #eedd82;">static_configs</span>:
      - <span style="color: #eedd82;">targets</span>: [<span style="color: #ffa07a;">'localhost:9100'</span>]
</pre>
</div>

<p>
You can start the server by running the command "prometheus". It will
listen in port 9090 where you can access the html page. If you are not
lazy you can add a systemd service for prometheus (or whatever daemon
management you are using). To create a systemd service, add the
following content to the file
"/etc/systemd/system/prometheus.service":
</p>

<div class="org-src-container">
<pre class="src src-toml">[<span style="color: #98fb98;">Unit</span>]
<span style="color: #eedd82;">Description</span>=Prometheus
<span style="color: #eedd82;">Documentation</span>=https://github.com/prometheus/prometheus
<span style="color: #eedd82;">Wants</span>=network-online.target
<span style="color: #eedd82;">After</span>=network-online.target

[<span style="color: #98fb98;">Install</span>]
<span style="color: #eedd82;">WantedBy</span>=multi-user.target

[<span style="color: #98fb98;">Service</span>]
<span style="color: #eedd82;">Type</span>=simple
<span style="color: #eedd82;">User</span>=prometheus
<span style="color: #eedd82;">Group</span>=prometheus
<span style="color: #eedd82;">ExecReload</span>=/bin/kill -HUP $MAINPID
<span style="color: #eedd82;">ExecStart</span>=/usr/local/bin/prometheus \
  <span style="color: #eedd82;">--config.file</span>=/etc/prometheus/prometheus.yml \
  <span style="color: #eedd82;">--storage.tsdb.path</span>=/etc/prometheus/data \
  <span style="color: #eedd82;">--storage.tsdb.retention.time</span>=30d
</pre>
</div>

<p>
Then change permissions, reload the daemons and start the service:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo chown prometheus:prometheus -R /etc/prometheus
sudo systemctl daemon-reload
sudo systemctl start prometheus
</pre>
</div>

<p>
Prometheus has a web UI accessible by default at port <code>9090</code>, we will
now see how to setup Grafana, a popular and powerful UI to visualize
the data.
</p>
</div>
</div>


<div id="outline-container-org4fd340e" class="outline-2">
<h2 id="org4fd340e"><span class="section-number-2">4.</span> Setting up Grafana</h2>
<div class="outline-text-2" id="text-4">
<p>
Install Grafana from your favorite package manager:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo dnf install grafana
</pre>
</div>

<p>
Fedora already creates a systemd service so you can start it as usual,
otherwise you can create the service yourself like we did before.
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo systemctl start grafana-server
</pre>
</div>

<p>
If you are using the default Fedora's SELinux, in order to allow
grafana to use the prometheus tcp socket we need to write a custom
policy. Create the file "grafana [underscore] websm.te" and add the
following content:
</p>

<pre class="example">
module grafana_websm 1.0;

require {
    type grafana_t;
    type websm_port_t;
    class tcp_socket name_connect;
}

# Allow Grafana to connect to ports labeled websm_port_t
allow grafana_t websm_port_t:tcp_socket name_connect;
</pre>

<p>
Then compile It and load It:
</p>

<div class="org-src-container">
<pre class="src src-bash">checkmodule -M -m -o grafana_websm.mod grafana_websm.te
semodule_package -o grafana_websm.pp -m grafana_websm.mod
sudo semodule -i grafana_websm.pp
</pre>
</div>

<p>
Additionally, if you are using a firewall and you want to access
the port from another device, you need to enable the port 3000.
On firewalld, you can use the following commands:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo firewall-cmd --permanent --add-port=30002/tcp
sudo firewall-cmd --reload
</pre>
</div>


<p>
You can finally go to "<a href="http://localhost:3000">http://localhost:3000</a>" and login with "admin"
as the username and password and add prometheus as a source in Home &gt;
Connections &gt; Add a new connection and search for prometheus.
</p>

<p>
You can find already made dashboards for node exporter on the <a href="https://grafana.com/grafana/dashboards/?search=node+exporter">grafana
website</a>.
</p>



<div id="orgcfdaf47" class="figure">
<p><img src="../../ephemeris/images/grafana.png" alt="grafana.png" width="600px" align="center" />
</p>
<p><span class="figure-number">Figure 1: </span>Grafana dashboard I found online</p>
</div>
</div>
</div>

<div id="outline-container-org4ca5580" class="outline-2">
<h2 id="org4ca5580"><span class="section-number-2">5.</span> Custom Exporter</h2>
<div class="outline-text-2" id="text-5">
<p>
What if you wanted to log something custom to your dashboard, you
can easily do this by starting a tcp server and serving the data you
want prometheus to read. Then, you need to tell prometheus to fetch
your service like we did for node exporter.
</p>

<p>
One of the simplest way to create a server is using socat. For example,
the following script creates a server that serves the system's load
average metric for prometheus.
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #ff7f24;">#</span><span style="color: #ff7f24;">!/bin/</span><span style="color: #00ffff;">bash</span>

<span style="color: #b0c4de;">set</span> -e

<span style="color: #eedd82;">INTERVAL</span>=5  <span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">seconds</span>
<span style="color: #eedd82;">METRICS_FILE</span>=<span style="color: #ffa07a;">"/tmp/power_metrics.prom"</span>
<span style="color: #eedd82;">PORT</span>=9200
touch $<span style="color: #eedd82;">METRICS_FILE</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Start background HTTP server</span>
socat TCP-LISTEN:$<span style="color: #eedd82;">PORT</span>,reuseaddr,fork SYSTEM:<span style="color: #ffa07a;">"echo HTTP/1.0 200; echo Content-Type\: text/plain; echo; cat \"$METRICS_FILE\""</span> &amp;

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Metrics writer loop</span>
<span style="color: #00ffff;">while</span> true; <span style="color: #00ffff;">do</span>
    sleep <span style="color: #ffa07a;">"$INTERVAL"</span>

    <span style="color: #eedd82;">loadavg</span>=$(cat /proc/loadavg | awk <span style="color: #ffa07a;">'{print $1 }'</span>)

    cat &lt;&lt;EOF &gt; <span style="color: #ffa07a;">"$METRICS_FILE"</span>
<span style="color: #ffff00; font-weight: bold;">    # HELP loadavg Load Average</span>
<span style="color: #ffff00; font-weight: bold;">    # TYPE loadavg gauge</span>
<span style="color: #ffff00; font-weight: bold;">    loadavg $loadavg</span>
<span style="color: #ffff00; font-weight: bold;">    EOF</span>
<span style="color: #00ffff;">done</span>
</pre>
</div>

<p>
And update the <code>prometheus.yml</code> file:
</p>

<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #eedd82;">scrape_configs</span>:
  ...
  - <span style="color: #eedd82;">job_name</span>: <span style="color: #ffa07a;">'load-average'</span>
    <span style="color: #eedd82;">scrape_interval</span>: 5s
    <span style="color: #eedd82;">static_configs</span>:
      - <span style="color: #eedd82;">targets</span>: [<span style="color: #ffa07a;">'localhost:9200'</span>]
</pre>
</div>


<p>
This script runs the tcp server in the background and updates the
served content each <code>$INTERVAL</code> seconds and It exposes the <code>loadavg</code>
metric with the value of the average system load in the last
minute. You can now add a new dashboard in grafana from the dashboard
section and clicking "New &gt; New Dashboard &gt; Add Visualization". You
select prometheus as a source and you add your custom metric and clock
"apply".
</p>


<div id="orgcc9828f" class="figure">
<p><img src="../../ephemeris/images/grafana-custom.png" alt="grafana-custom.png" width="600px" align="center" />
</p>
<p><span class="figure-number">Figure 2: </span>Custom dashboard</p>
</div>

<p>
You can create the http server in any other way, maybe integrate
It with the application you have been working on, and so on.
</p>


<hr />

<p>
Travel: <a href="./notes.html">Linux Notes</a>, <a href="../../theindex.html">Index</a>
</p>
</div>
</div>
]]></description>
</item>
<item>
<title>Optimize power consumption on Linux</title>
<link>https://giovanni-diary.netlify.app/programming/linux/optimize-power-consumption-linux.html</link>
<author>Giovanni Santini</author>
<pubDate>15 Apr 2025 00:00:00 GMT</pubDate>
<description><![CDATA[<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgf932004">1. Index</a></li>
<li><a href="#org28b27f3">2. ACPI Specification</a></li>
<li><a href="#org6df305d">3. Linux's ACPI</a></li>
<li><a href="#orgc2b776f">4. Understand what consumes the most</a>
<ul>
<li><a href="#org070c5e8">4.1. Powertop</a></li>
<li><a href="#org843743e">4.2. Iotop</a></li>
<li><a href="#orgcced40f">4.3. Plot CPU power usage</a></li>
</ul>
</li>
<li><a href="#org5d90a7b">5. Save yourself time: TLP</a></li>
<li><a href="#org490e430">6. Kernel Settings</a>
<ul>
<li><a href="#orgb5958e9">6.1. Frequency Scaling</a></li>
<li><a href="#org4ddcc2b">6.2. Maximum charge level</a></li>
<li><a href="#org67e9997">6.3. Omit Scheduling-Clock ticks for idle CPUs</a></li>
<li><a href="#org1ba4d8b">6.4. Disable Atime in BTRFS</a></li>
<li><a href="#org733a215">6.5. Kernel Flags</a></li>
</ul>
</li>
<li><a href="#orga0f4684">7. Helpful tips</a>
<ul>
<li><a href="#org45e85f2">7.1. Light graphical session</a></li>
<li><a href="#orgf62dcde">7.2. Have less background processes running</a></li>
<li><a href="#orgd9d7a0f">7.3. Lower the backlight</a></li>
</ul>
</li>
<li><a href="#org27e1f52">8. Conclusions</a></li>
</ul>
</div>
</div>
<p>
This documents contains notes regarding my efforts to increase
battery life on my Linux laptop[s]. I don't use my laptop for
computational-expensive tasks, I'd rather prefer the battery to last
longer. Here is a list of things I did to optimize for lower power
consumption.
</p>

<p>
This guide is focused on laptops but you can get value even for desktop
servers. If you have any comment / correction / suggestion please let
me know by sending me an email at <a href="mailto:giovanni.santini@proton.me">giovanni.santini@proton.me</a> or message
me on Mastodon <a href="https://mastodon.social/@santo7">@santo7@mastodon.social</a>.
</p>

<div id="outline-container-orgf932004" class="outline-2">
<h2 id="orgf932004"><span class="section-number-2">1.</span> Index</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>ACPI Specification</li>
<li>Linux's ACPI</li>
<li>Understand what consumes the most
<ul class="org-ul">
<li>Powertop</li>
<li>Iotop</li>
<li>Plot power usage</li>
</ul></li>
<li>Save yourself some time: TLP</li>
<li>Kernel Settings
<ul class="org-ul">
<li>Frequency scaling</li>
<li>Maximum charge level</li>
<li>Omit Scheduling-Clock ticks for idle CPUs</li>
<li>Disable Atime in BTRFS</li>
<li>Kernel flags</li>
</ul></li>
<li>Helpful tips
<ul class="org-ul">
<li>Light graphical sessions</li>
<li>Have less background processes running</li>
<li>Lower the backlight</li>
</ul></li>
<li>Conclusions</li>
</ul>
</div>
</div>

<div id="outline-container-org28b27f3" class="outline-2">
<h2 id="org28b27f3"><span class="section-number-2">2.</span> ACPI Specification</h2>
<div class="outline-text-2" id="text-2">
<p>
Before tinkering with your system, you should have a decent
understanding of how the operating system works in the context of
power management. I will now give you a quick overview of power
consumption on a linux system running on the x86 architecture.
</p>

<p>
Let's start with the hardware and how we can interact with It, more
specifically the CPU. Similarly to other hardware components, intel
CPUs implement the <a href="https://uefi.org/htmlspecs/ACPI_Spec_6_4_html/">ACPI</a> specification which enables an ACPI compatible
operating system to interface with hardware devices to fine tune
performance.
</p>

<p>
For processors, ACPI defines different power states within the global
working state G0, and they are called "Cx states": C0 means that the
processor is executing instructions, C1 to Cn are sleeping states
where the processor consumes less; C3 consumes less than C2 which
consumes less than C1 (but this is not specified from C4 to Cn).
</p>

<p>
Furthermore, ACPI defines "Px states" which are other states inside
C0, where P0 is maximum performance. Operating systems can change the
performance state of a core "on the fly" which is known as CPU
throttling, giving us more opportunity for optimizations.
</p>

<p>
Hardware may send interrupts that can wake up a processor from a
sleeping or low-power state, therefore you should try to minimize the
number of interrupts (by disabling devices) or balance them
efficiently across cores (using something like <a href="https://linux.die.net/man/1/irqbalance">irqbalance</a>, for
example).
</p>

<p>
Going back to ACPI, other devices are also a great source of power
consumption. Hardware other than processors have "device power states"
D0 to D3 where D0 means that the device is fully on, D3 that It is
off. ACPI further defines those states for many device types (network,
storage&#x2026;).
</p>
</div>
</div>

<div id="outline-container-org6df305d" class="outline-2">
<h2 id="org6df305d"><span class="section-number-2">3.</span> Linux's ACPI</h2>
<div class="outline-text-2" id="text-3">
<p>
An overview of the Linux's ACPI implementation can be found <a href="https://www.kernel.org/doc/ols/2005/ols2005v1-pages-59-76.pdf">here</a>.
Briefly, It is composed of an OS Service Layer which abstracts the
hardware, an user interface via sysfs and procfs, the core
implementation which includes an AML interpreter which is used as a
language between the firmware and the operating system, and other
components which are irrelevant for our discussion.
</p>

<p>
On Linux, userspace can interact with the ACPI subsystem via sysfs in
<code>/sys/devices/LNXSYSTM:00</code> or <code>/sys/bus/acpi/devices</code> (if ACPI support
is enabled). Inside, you will find directories that represent ACPI
devices, for each device the directory contains information about
them such as the status or the voltage. You may want to use something
like <code>acpid</code> or <code>upower</code> to dump ACPI info, if you are using some
linux distribution you may have something similar already installed.
</p>

<p>
Obviously, the more stuff you are doing with your computer, the more
energy It will consume. You should prefer light software compiled to
machine code, with optimizations enabled and stripped debug
information. We will discuss more what other optimizations you can
implement.
</p>
</div>
</div>

<div id="outline-container-orgc2b776f" class="outline-2">
<h2 id="orgc2b776f"><span class="section-number-2">4.</span> Understand what consumes the most</h2>
<div class="outline-text-2" id="text-4">
<p>
While you may try to thinker with configuration files and settings
following common heuristics (such as "less processes = less power
consumption"), It is more effective to first evaluate the power
consumption of your operating system and then make changes to the most
power-draining sources in order to have a greater impact on the
overall power consumption.
</p>

<p>
The hard truth is that the best way to get accurate measurements is
via some external power meters. You can use various types of smart
plugs or usually your UPS for this, however I don't own any of this
hardware so I will not give advice. Instead, I will focus on the
software side of things and get best-effort data.  Even with software,
what you can get greately depends on what your hardware provides.
</p>
</div>

<div id="outline-container-org070c5e8" class="outline-3">
<h3 id="org070c5e8"><span class="section-number-3">4.1.</span> Powertop</h3>
<div class="outline-text-3" id="text-4-1">
<p>
A general tool that works well is <a href="https://linux.die.net/man/8/powertop">powertop</a> which will give you
per-process power consumption and information about CPU states,
devices and tunable settings to decrease power consumption. It is good
practice to calibrate the tool with <code>powertop --calibrate</code> (only on
laptops) before collecting data, this will setup the tool to show
correct estimations about power consumption.
</p>

<p>
From the overview tab you can easily see which processes are consuming
more power so that you can look into them individually.  For example,
If you find that systemd is logging too much, try to increase the time
between logs, and so on.
</p>
</div>
</div>

<div id="outline-container-org843743e" class="outline-3">
<h3 id="org843743e"><span class="section-number-3">4.2.</span> Iotop</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Another useful tool is <a href="https://www.man7.org/linux/man-pages/man8/iotop.8.html">iotop</a> which will give you information about
disk usage. Even though this does not directly list power
consumption, there is a correlation between disk usage and power
consumption so it is beneficial to look into this.
</p>

<p>
You may start playing around with filesystems and mount options,
later we'll see an option in BTRFS that improves performance.
</p>
</div>
</div>

<div id="outline-container-orgcced40f" class="outline-3">
<h3 id="orgcced40f"><span class="section-number-3">4.3.</span> Plot CPU power usage</h3>
<div class="outline-text-3" id="text-4-3">
<p>
To evaluate a change in your system, you can log and graph different
statistics and compare changes. The following script records CPU power
consumption in Watts on intel systems, It uses intel-rapl to fetch the
data, you may need to adapt the code if you are using a CPU from a
different brand.
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #ff7f24;">#</span><span style="color: #ff7f24;">!/bin/</span><span style="color: #00ffff;">bash</span>

<span style="color: #b0c4de;">set</span> -e

<span style="color: #eedd82;">OUTFILE</span>=<span style="color: #ffa07a;">"power_log.csv"</span>
<span style="color: #eedd82;">INTERVAL</span>=1  <span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">seconds</span>
<span style="color: #eedd82;">ENERGY_PATH</span>=/sys/class/powercap/intel-rapl:0/energy_uj

<span style="color: #00ffff;">function</span> <span style="color: #87cefa;">get_energy</span>
{
  cat $<span style="color: #eedd82;">ENERGY_PATH</span>)
}

<span style="color: #00ffff;">function</span> <span style="color: #87cefa;">get_time_seconds</span>
{
  date +%s
}

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Overwrites $OUTFILE</span>
<span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"timestamp,power_watts"</span> &gt; <span style="color: #ffa07a;">"$OUTFILE"</span>

<span style="color: #eedd82;">prev_energy</span>=$(get_energy)
<span style="color: #eedd82;">prev_time</span>=$(get_time_seconds)

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Calculate and append power consumption in watts to $OUTFILE with</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">a timestamp. Watts are calculated by dividing the difference in</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">energy between $INTERVAL by the $INTERVAL</span>
<span style="color: #00ffff;">while</span> true; <span style="color: #00ffff;">do</span>
    sleep <span style="color: #ffa07a;">"$INTERVAL"</span>

    <span style="color: #eedd82;">curr_energy</span>=$(get_energy)
    <span style="color: #eedd82;">curr_time</span>=$(get_time_seconds)
    <span style="color: #eedd82;">delta_energy</span>=$((curr_energy - prev_energy))
    <span style="color: #eedd82;">delta_time</span>=$((curr_time - prev_time))

    <span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Handle energy wraparound (32-bit counter)</span>
    <span style="color: #00ffff;">if</span> [[ $<span style="color: #eedd82;">delta_energy</span> -lt 0 ]]; <span style="color: #00ffff;">then</span>
        <span style="color: #eedd82;">delta_energy</span>=$(( (2**32 + delta_energy) ))
    <span style="color: #00ffff;">fi</span>

    <span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Convert to watts</span>
    <span style="color: #eedd82;">power</span>=$(awk <span style="color: #ffa07a;">"BEGIN { printf \"%.2f\", ($delta_energy / 1000000) / $delta_time }"</span>)
    <span style="color: #eedd82;">timestamp</span>=$(date +<span style="color: #ffa07a;">"%H:%M:%S"</span>)
    <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"$timestamp,$power"</span> | tee -a <span style="color: #ffa07a;">"$OUTFILE"</span>

    <span style="color: #eedd82;">prev_energy</span>=$<span style="color: #eedd82;">curr_energy</span>
    <span style="color: #eedd82;">prev_time</span>=$<span style="color: #eedd82;">curr_time</span>
<span style="color: #00ffff;">done</span>
</pre>
</div>

<p>
You can then graph it with gnuplot:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #b0c4de;">set</span> datafile separator <span style="color: #ffa07a;">","</span>
<span style="color: #b0c4de;">set</span> xdata time
<span style="color: #b0c4de;">set</span> timefmt <span style="color: #ffa07a;">"%H:%M:%S"</span>
<span style="color: #b0c4de;">set</span> format x <span style="color: #ffa07a;">"%H:%M:%S"</span>
<span style="color: #b0c4de;">set</span> xlabel <span style="color: #ffa07a;">"Time"</span>
<span style="color: #b0c4de;">set</span> ylabel <span style="color: #ffa07a;">"Power (Watts)"</span>
<span style="color: #b0c4de;">set</span> title <span style="color: #ffa07a;">"Power Consumption Over Time"</span>
<span style="color: #b0c4de;">set</span> grid
<span style="color: #b0c4de;">set</span> term pngcairo size 800,400
<span style="color: #b0c4de;">set</span> output <span style="color: #ffa07a;">"power_plot.png"</span>

plot <span style="color: #ffa07a;">"power_log.csv"</span> using 1:2 with lines title <span style="color: #ffa07a;">"Power (W)"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">gnuplot plot_power.gp
</pre>
</div>



<div id="org2b44dc0" class="figure">
<p><img src="../../ephemeris/images/gnuplot-power.jpeg" alt="gnuplot-power.jpeg" width="600px" align="center" />
</p>
<p><span class="figure-number">Figure 1: </span>Gnuplot output</p>
</div>

<p>
Additionally, you could export the data to prometheus with a similar
script so that it integrates with the <a href="linux-monitoring-with-prometheus-and-grafana.html">prometheus + grafana</a> stack.
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #ff7f24;">#</span><span style="color: #ff7f24;">!/bin/</span><span style="color: #00ffff;">bash</span>

<span style="color: #b0c4de;">set</span> -e

<span style="color: #eedd82;">ENERGY_PATH</span>=/sys/class/powercap/intel-rapl:0/energy_uj
<span style="color: #eedd82;">INTERVAL</span>=1  <span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">seconds</span>
<span style="color: #eedd82;">METRICS_FILE</span>=<span style="color: #ffa07a;">"/tmp/power_metrics.prom"</span>
<span style="color: #eedd82;">PORT</span>=9200

<span style="color: #00ffff;">function</span> <span style="color: #87cefa;">get_energy</span> {
    cat <span style="color: #ffa07a;">"$ENERGY_PATH"</span>
}

<span style="color: #00ffff;">function</span> <span style="color: #87cefa;">get_time</span> {
    date +%s
}

<span style="color: #eedd82;">prev_energy</span>=$(get_energy)
<span style="color: #eedd82;">prev_time</span>=$(get_time)

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Start background HTTP server</span>
socat TCP-LISTEN:$<span style="color: #eedd82;">PORT</span>,reuseaddr,fork SYSTEM:<span style="color: #ffa07a;">"echo HTTP/1.0 200; echo Content-Type\: text/plain; echo; cat \"$METRICS_FILE\""</span> &amp;

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Metrics writer loop</span>
<span style="color: #00ffff;">while</span> true; <span style="color: #00ffff;">do</span>
    sleep <span style="color: #ffa07a;">"$INTERVAL"</span>

    <span style="color: #eedd82;">curr_energy</span>=$(get_energy)
    <span style="color: #eedd82;">curr_time</span>=$(get_time)

    <span style="color: #eedd82;">delta_energy</span>=$((curr_energy - prev_energy))
    <span style="color: #eedd82;">delta_time</span>=$((curr_time - prev_time))

    <span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Handle 32-bit wraparound</span>
    <span style="color: #00ffff;">if</span> [[ $<span style="color: #eedd82;">delta_energy</span> -lt 0 ]]; <span style="color: #00ffff;">then</span>
        <span style="color: #eedd82;">delta_energy</span>=$(( (2**32 + delta_energy) ))
    <span style="color: #00ffff;">fi</span>

    <span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Calculate power in watts</span>
    <span style="color: #eedd82;">power</span>=$(awk <span style="color: #ffa07a;">"BEGIN { printf \"%.2f\", ($delta_energy / 1000000) / $delta_time }"</span>)

    cat &lt;&lt;EOF &gt; <span style="color: #ffa07a;">"$METRICS_FILE"</span>
<span style="color: #ffff00; font-weight: bold;"># HELP node_power_watts Estimated power usage from RAPL</span>
<span style="color: #ffff00; font-weight: bold;"># TYPE node_power_watts gauge</span>
<span style="color: #ffff00; font-weight: bold;">node_power_watts $power</span>
<span style="color: #ffff00; font-weight: bold;">EOF</span>

    <span style="color: #eedd82;">prev_energy</span>=$<span style="color: #eedd82;">curr_energy</span>
    <span style="color: #eedd82;">prev_time</span>=$<span style="color: #eedd82;">curr_time</span>
<span style="color: #00ffff;">done</span>
</pre>
</div>

<p>
And you need to add this to the <code>prometheus.yaml</code> file:
</p>

<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #eedd82;">scrape_configs</span>:
- <span style="color: #eedd82;">job_name</span>: <span style="color: #ffa07a;">'cpu_power'</span>
  <span style="color: #eedd82;">static_configs</span>:
    - <span style="color: #eedd82;">targets</span>: [<span style="color: #ffa07a;">'localhost:9200'</span>]
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org5d90a7b" class="outline-2">
<h2 id="org5d90a7b"><span class="section-number-2">5.</span> Save yourself time: TLP</h2>
<div class="outline-text-2" id="text-5">
<p>
To save yourself some time configuring your system, you can use <a href="https://linrunner.de/tlp/introduction.html">TLP</a>
(or any similar tool) which automatically configures the kernel with
power saving settings. It is supposed to work well out of the box but
you can manually configure the settings via a configuration file in
<code>/etc/tlp.conf</code>. Please refer to the <a href="https://linrunner.de/tlp/index.html">documentation</a> for further
details.
</p>

<p>
The installation is quite strait forward, check your package
manager. To apply a power profile, run the following
command (do this every time you change the configuration file):
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo tlp start
</pre>
</div>

<p>
To get system information and the status of the tool, run the
following:
</p>
<div class="org-src-container">
<pre class="src src-bash">tlp-stat -s
</pre>
</div>

<p>
There are plenty of utilities like this, use them at your own risk.
</p>
</div>
</div>

<div id="outline-container-org490e430" class="outline-2">
<h2 id="org490e430"><span class="section-number-2">6.</span> Kernel Settings</h2>
<div class="outline-text-2" id="text-6">
<p>
There are many settings you can tune on linux, which will mostly
depend on your hardware and drivers. A decent list can be found in the
Archlinux's <a href="https://wiki.archlinux.org/title/Power_management">Power Management</a> page.
</p>

<p>
To access the ACPI subsystem you need to have the following
enabled in your <a href="https://wiki.gentoo.org/wiki/Power_management/Guide">kernel</a>:
</p>

<pre class="example">
Power management and ACPI options ---&gt;
-*- Device power management core functionality
[*] ACPI (Advanced Configuration and Power Interface) Support ---&gt;
  &lt;*&gt; AC Adapter
  &lt;*&gt; Battery
  -*- Button
  -*- Video
  &lt;*&gt; Fan
  &lt;*&gt; Processor
  &lt;*&gt; Thermal Zone

[*] CPU Frequency scaling ---&gt;
      Default CPUFreq governor (ondemand)  ---&gt;
  -*- 'performance' governor
  &lt;*&gt; 'powersave' governor
  &lt;*&gt; 'userspace' governor for userspace frequency scaling
  -*- 'ondemand' cpufreq policy governor
  &lt;*&gt; 'conservative' cpufreq governor
  &lt;*&gt; ACPI Processor P-States driver
</pre>

<p>
Additionally, enable Thermal and Powercap sysfs for your CPU:
</p>

<pre class="example">
Device Drivers ---&gt;
-*- Thermal drivers ---&gt;
  (0)   Emergency poweroff delay in milli-seconds                                                                              
  [*]   Expose thermal sensors as hwmon device                                                                                
  -*-   Enable writable trip points                                                                                          
        Default Thermal governor (step_wise)  ---&gt;                                                                           
  [*]   Fair-share thermal governor                                                                                           
  -*-   Step_wise thermal governor                                                                                            
  -*-   Bang Bang thermal governor                                                                                            
  -*-   User_space thermal governor                                                                                           
  [ ]   Thermal emulation mode support
  [*]   Power allocator thermal governor   
  Intel Thermal drivers ---&gt;
      &lt;M&gt;   Intel PowerClamp idle injection driver
      &lt;M&gt;   X86 package temperature thermal driver
      &lt; &gt;   Intel SoCs DTS thermal driver
      &lt;M&gt;   Intel PCH Thermal Reporting Driver
      ACPI INT340X thermal drivers  ---&gt;                                                                                     
          &lt;M&gt; ACPI INT340X thermal drivers
</pre>

<p>
And RAPL, which gives additional information about the processor:
</p>

<pre class="example">
Device Drivers ---&gt;
[*] Generic powercap sysfs driver ---&gt;
  &lt;M&gt;   Intel RAPL Support
</pre>

<p>
Now you should have all the requirements to start playing with
the settings, <code>tlp.conf</code> is a good place to start.
</p>
</div>

<div id="outline-container-orgb5958e9" class="outline-3">
<h3 id="orgb5958e9"><span class="section-number-3">6.1.</span> Frequency Scaling</h3>
<div class="outline-text-3" id="text-6-1">
<p>
You can choose a frequency scaling governor to manage throttling.
This will dynamically change the clock's frequency and voltage
configuration via P-states. Assuming you are using TLP, to list the
available governors you can run:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo tlp-stat -p | grep governor
</pre>
</div>

<p>
By default, Fedora 41 has "performance" and "powersave", so I choose
powersave in tlp's settings (which is the default setting).
</p>
</div>
</div>

<div id="outline-container-org4ddcc2b" class="outline-3">
<h3 id="org4ddcc2b"><span class="section-number-3">6.2.</span> Maximum charge level</h3>
<div class="outline-text-3" id="text-6-2">
<p>
To increase battery life, It is recommended to reduce the maximum
charge level below 100% and prevent the charging process to happen for
every short discharge from the maximum. By default, TLP does not set
this. To enable it, set the variables <code>START_CHARGE_THRESH_BATx</code> and
<code>START_CHARGE_THRESH_BATx</code> to something like <code>75</code> and <code>80</code>, where <code>x</code>
represent the number of the battery in your laptop.  Sadly, on some
laptops (like my HP one) this is not supported and the command
<code>tlp-stat -b</code> would output
<code>/sys/class/power_supply/BAT1/charge_control_start_threshold (not available)</code>.
</p>
</div>
</div>

<div id="outline-container-org67e9997" class="outline-3">
<h3 id="org67e9997"><span class="section-number-3">6.3.</span> Omit Scheduling-Clock ticks for idle CPUs</h3>
<div class="outline-text-3" id="text-6-3">
<p>
If you are doing mostly lightweight work with long idle periods, you
can limit the scheduling-clock interrupt to prevent waking up some
cores when It is not needed. The linux kernel <a href="https://www.kernel.org/doc/html/latest/timers/no_hz.html#omit-scheduling-clock-ticks-for-cpus-with-only-one-runnable-task">documentation</a> says that
if scheduling is set to periodic, the system would drain 2-3 times
faster compared to a kernel with this disabled, so It is quite a big
deal. You may need it if you are running aggressive real-time
response constraints, but this is not our case.
</p>

<p>
Enable the following in your kernel configuration:
</p>

<pre class="example">
CONFIG_NO_HZ_IDLE=y
CONFIG_HZ_100=y 
</pre>
</div>
</div>

<div id="outline-container-org1ba4d8b" class="outline-3">
<h3 id="org1ba4d8b"><span class="section-number-3">6.4.</span> Disable Atime in BTRFS</h3>
<div class="outline-text-3" id="text-6-4">
<p>
BTRFS is a popular filesystem. A part of Its design is the CoW
(Copy on Write) where a certain file would get copied in another
location when a modification is made, this is necessary for
the snapshotting functionality of the filesystem. However, this
causes the problem where a file would get copied even if you
just read it, just by updating the last access timestamp. <a href="https://lwn.net/Articles/499293/">This</a>
LWN article from Jonathan Corbet explains this well:
</p>

<blockquote>
<p>
If somebody takes a snapshot of a filesystem, then performs a
recursive grep on that filesystem, the last-access time of every
file touched may be updated. That, in turn, can cause copy-on-write
operations on each file's inode structure, with the result that many
or all of the inodes in the filesystem may be duplicated. That can
increase the space consumption of the filesystem considerably;
Alexander posted an example where a recursive grep caused 2.2GB of
free space to disappear. That is a surprising result for what is
meant to be a read-only operation.
</p>
</blockquote>

<p>
To disable the Atime feature, you need to put the <code>noatime</code> option
on the BTRFS entries in <code>/etc/fstab</code>. Note that some applications
or test cases that rely on sensitive timestamps may break, so
keep this in mind.
</p>
</div>
</div>

<div id="outline-container-org733a215" class="outline-3">
<h3 id="org733a215"><span class="section-number-3">6.5.</span> Kernel Flags</h3>
<div class="outline-text-3" id="text-6-5">
<p>
You can add the following kernel flags when booting your system:
</p>
<ul class="org-ul">
<li><code>pcie_aspm=force</code>: force PCIe Active State Power Management
to put PCIe devices into low-power states. Some devices may
stop working if they are not implemented correctly, so do your
own tests.</li>
<li>For intel GPUs:
<ul class="org-ul">
<li><code>i915.enable_dc=2</code>: enable the display engine to enter
low-power states.</li>
<li><code>i915.enable_fbc=1</code>: enables Frame Buffer Compression (FBC),
reducing memory bandwidth when the screen content is static</li>
<li><code>i915.enable_psr=1</code>: enables Panel Self Refresh (PSR)  lets the
display refresh from its own memory instead of continuously
redrawing.</li>
</ul></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orga0f4684" class="outline-2">
<h2 id="orga0f4684"><span class="section-number-2">7.</span> Helpful tips</h2>
<div class="outline-text-2" id="text-7">
<p>
Here is a list of other helpful things that will make your operating
system lighter and more efficient.
</p>
</div>

<div id="outline-container-org45e85f2" class="outline-3">
<h3 id="org45e85f2"><span class="section-number-3">7.1.</span> Light graphical session</h3>
<div class="outline-text-3" id="text-7-1">
<p>
If you are using a graphical environment, chances are that you do not
need a full blown desktop environment to manage the position of your
windows. The lighter your window manager, the better. My argument is
that all you need is a program that can create windows and move them;
such program should be simple and small, understandable and hackable.
Everything else is bloated software, I would suggest something like
<a href="https://dwm.suckless.org/">dwm</a> or <a href="https://www.ctwm.org/index.html">ctwm</a>.
</p>

<p>
I did not compare Wayland-based window managers against X11, I found
some benchmarks <a href="https://www.phoronix.com/news/GNOME-Xorg-Wayland-AMD-Renoir">online</a> and they are similar in power consumption but
the benchmarks were made with Gnome. Unless you find a really minimal
window manager using wayland, the good old simple X11 window managers
are the best.
</p>
</div>
</div>

<div id="outline-container-orgf62dcde" class="outline-3">
<h3 id="orgf62dcde"><span class="section-number-3">7.2.</span> Have less background processes running</h3>
<div class="outline-text-3" id="text-7-2">
<p>
If you are using a linux distribution instead of compiling your system
on your own, chances are that the maintainers of said distribution
have enabled a bunch of stuff you don't really need. This goes from
kernel modules for various hardware, which you do not need, to
background daemons to do things like reporting crashes.
</p>

<p>
If your system uses systemd, you can check active services using the
<code>systemctl status</code> command. Even though many of them may be idle and
may not contribute much to the overall power consumption, they still
consume resources so It is helpful to have less things running in
your system.
</p>

<p>
Disable things like Bluetooth if you don't need it, crash reporting
daemons, etc&#x2026;
</p>
</div>
</div>

<div id="outline-container-orgd9d7a0f" class="outline-3">
<h3 id="orgd9d7a0f"><span class="section-number-3">7.3.</span> Lower the backlight</h3>
<div class="outline-text-3" id="text-7-3">
<p>
Lower the backlight of your laptop as much as you are comfortable
with.
</p>
</div>
</div>
</div>

<div id="outline-container-org27e1f52" class="outline-2">
<h2 id="org27e1f52"><span class="section-number-2">8.</span> Conclusions</h2>
<div class="outline-text-2" id="text-8">
<p>
I hope you learned something new from this article. I will keep this
updated with new information I gain overtime, if you have any
suggestion to improve the work I'd be happy to hear it.
</p>

<hr />

<p>
Travel: <a href="./notes.html">Linux Notes</a>, <a href="../../theindex.html">Index</a>
</p>
</div>
</div>
]]></description>
</item>
<item>
<title>Performance analysis on Linux</title>
<link>https://giovanni-diary.netlify.app/programming/linux/performance-analysis-on-linux.html</link>
<author>Giovanni Santini</author>
<pubDate>31 May 2025 00:00:00 GMT</pubDate>
<description><![CDATA[<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgc5f27ab">1. Introduction</a></li>
<li><a href="#org678ed7b">2. Perf</a>
<ul>
<li><a href="#org4536607">2.1. Flamegraphs</a></li>
<li><a href="#org69014e0">2.2. Hotspot</a></li>
</ul>
</li>
<li><a href="#orgff51437">3. Valgrind + kcachegrind</a></li>
<li><a href="#orgc00dfab">4. Conclusions</a></li>
</ul>
</div>
</div>
<p>
In this document I will discuss several method to analyze the
performance of a process on a Linux system. This page will be
incrementally updated as I get more experience over time, with the aim
to be a useful resource to everyone.
</p>

<div id="outline-container-orgc5f27ab" class="outline-2">
<h2 id="orgc5f27ab"><span class="section-number-2">1.</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
Consider the following problem: given a native application, I want to
know which parts or functions are impacting performance the most so
that I have a better idea of where to look for when optimizing for
performance.
</p>

<p>
Here I will only discuss native (compiled) applications. Interpreted
programs should have their own tools for performance analysis, which
falls outside of the scope of this document. Regardless, you could
always <a href="benchmarking-on-linux.html">benrchmark</a> them as if the program was a black box.
</p>

<p>
Instead, what I am more interested in is to break apart an application
and understand where execution time is spent and where can I increase
performance. We will see some powerful tools and how to use them
in the following chapters.
</p>
</div>
</div>

<div id="outline-container-org678ed7b" class="outline-2">
<h2 id="org678ed7b"><span class="section-number-2">2.</span> Perf</h2>
<div class="outline-text-2" id="text-2">
<p>
Perf is incredibly powerful tool for retrieving performance data on a
Linux system. The userspace tool is maintained in the kernel source
tree and it leverages perf events, which are in-kernel special
instrumentation that perf can hook into. You can get a list of all the
available events in your kernel via the command <code>perf list</code>.
</p>

<p>
We will now focus out attention on two perf subcommands: <code>record</code> and
<code>report</code>.
</p>

<p>
In order to record performance data , you can use <code>perf record
&lt;command&gt;</code>, or <code>perf record -p &lt;PID&gt; -- sleep 10</code> to attach to a
certain process with PID <code>&lt;PID&gt;</code> for 10 seconds. This will generate a
file "perf.data" containing all the information after execution. You
can supply additional flags and attach to a running process via Its
PID, refer to the man page of perf-record(1) for additional
information.
</p>

<div class="org-src-container">
<pre class="src src-bash">perf record -F 4000 -a -g &lt;command-here&gt;
</pre>
</div>

<p>
In the above example, I used the following flags:
</p>

<ul class="org-ul">
<li><code>-F</code>: set the frequency, you can set this to "max" if you want.</li>
<li><code>-a</code>: collect data from all CPUs</li>
<li><code>-g</code>: record call graphs</li>
</ul>

<p>
You can view the data using the following command:
</p>

<div class="org-src-container">
<pre class="src src-bash">perf report
</pre>
</div>

<p>
If you compiled your program with debug information and with no
optimization, perf will be able to retrieve names of functions and you
will see something like this:
</p>


<div id="org415f6ff" class="figure">
<p><img src="../../ephemeris/images/perf-report.png" alt="perf-report.png" width="600px" align="center" />
</p>
<p><span class="figure-number">Figure 1: </span>perf report output</p>
</div>

<p>
From here you can explore a list of all the functions and the
percentage of execution time they used. Additionally, you can inspect
each function deeper and see which assembly instructions are taking
more time to run.
</p>


<div id="orgc42e755" class="figure">
<p><img src="../../ephemeris/images/perf-report-asm.png" alt="perf-report-asm.png" width="600px" align="center" />
</p>
<p><span class="figure-number">Figure 2: </span>assembly instructions and their usage</p>
</div>

<p>
Perf is really powerful and I think It is worth learning in more
detail. If you want to learn more, you can start with the <a href="https://www.brendangregg.com/perf.html">perf
examples</a> from Brendan Gregg. You should also check out his <a href="https://www.brendangregg.com/linuxperf.html">other
pages</a> and his <a href="https://www.brendangregg.com/blog/index.html">blog</a>, he is an expert on performance analysis.
</p>
</div>

<div id="outline-container-org4536607" class="outline-3">
<h3 id="org4536607"><span class="section-number-3">2.1.</span> Flamegraphs</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Flamegraphs are a different and more intuitive visualization of the
same data: functions are represented as boxes and the width of the box
indicates how much time was spent in that function. Therefore, longer
boxes means longer execution time.
</p>

<p>
To generate those pictures, you can use the <a href="https://github.com/brendangregg/FlameGraph">Flame Graph</a> tool from
Brendan Gregg. Usually, in order to produce flame graphs you need
to perform 3 steps: record the data, fold the stacks and generate
the final SVG. With perf, this looks like this:
</p>

<div class="org-src-container">
<pre class="src src-bash">perf record -F 4000 -a -g &lt;command&gt;
perf script &gt; out.perf
stackcollapse-perf.pl out.perf &gt; out.folded
flamegraph.pl out.kern_folded &gt; kernel.svg
</pre>
</div>


<div id="org6cf3411" class="figure">
<p><img src="../../ephemeris/images/perf-flame-graph.svg" alt="perf-flame-graph.svg" class="org-svg" width="600px" align="center" />
</p>
<p><span class="figure-number">Figure 3: </span>example flame graph</p>
</div>
</div>
</div>

<div id="outline-container-org69014e0" class="outline-3">
<h3 id="org69014e0"><span class="section-number-3">2.2.</span> Hotspot</h3>
<div class="outline-text-3" id="text-2-2">
<p>
There are various GUI applications to visualize perf data. One
good example if <a href="https://github.com/KDAB/hotspot">Hotspot</a> which shows you flame graphs and a
timeline. It is really easy to play around, check it out.
</p>


<div id="orgb02b90a" class="figure">
<p><img src="../../ephemeris/images/perf-hotspot.png" alt="perf-hotspot.png" width="600px" align="center" />
</p>
<p><span class="figure-number">Figure 4: </span>hotspot screenshot</p>
</div>
</div>
</div>
</div>


<div id="outline-container-orgff51437" class="outline-2">
<h2 id="orgff51437"><span class="section-number-2">3.</span> Valgrind + kcachegrind</h2>
<div class="outline-text-2" id="text-3">
<p>
Valgrind is another powerful program for debugging and profiling Linux
executables. In the context of profiling, you can use the callgrind
tool to collect the data:
</p>

<div class="org-src-container">
<pre class="src src-bash">valgrind --tool=callgrind --dump-instr=yes --simulate-cache=yes &lt;program&gt;
</pre>
</div>

<p>
Then you can use a GUI tool like <a href="https://github.com/KDE/kcachegrind">kcachegrind</a> to visualize the data.
</p>


<div id="org409b71a" class="figure">
<p><img src="../../ephemeris/images/kcallgrind.png" alt="kcallgrind.png" width="600px" align="center" />
</p>
<p><span class="figure-number">Figure 5: </span>kcallgrind screenshot</p>
</div>
</div>
</div>


<div id="outline-container-orgc00dfab" class="outline-2">
<h2 id="orgc00dfab"><span class="section-number-2">4.</span> Conclusions</h2>
<div class="outline-text-2" id="text-4">
<p>
We have seen a few solutions to get performance information of our
program. If you have any suggestion or comments about the page, please
reach out to me via email at at <a href="mailto:giovanni.santini@proton.me">giovanni.santini@proton.me</a> or message
me on Mastodon <a href="https://mastodon.social/@santo7">@santo7@mastodon.social</a>.
</p>

<hr />

<p>
Travel: <a href="./notes.html">Linux Notes</a>, <a href="../../theindex.html">Index</a>
</p>
</div>
</div>
]]></description>
</item>
<item>
<title>Eigenvalues and Eigenvectors</title>
<link>https://giovanni-diary.netlify.app/programming/eigenvalues-and-eigenvectors.html</link>
<author>Giovanni Santini</author>
<pubDate>10 Jun 2025 00:00:00 GMT</pubDate>
<description><![CDATA[<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org91fe478">1. Definition</a></li>
</ul>
</div>
</div>
<p>
Today we will look at Eigenvalues and Eigenvectors in linear
algebra. I will use the great book "Algebra Lineare" by Marco Abate as
my reference.
</p>

<p>
Eigenvectors are an important theoretical and practical topic, they
are is used in <a href="../notes/ml/09-unsupervised-learning.html">machine learning</a> and are often used as the preferred
axis for rotations or other transformations.
</p>

<div id="outline-container-org91fe478" class="outline-2">
<h2 id="org91fe478"><span class="section-number-2">1.</span> Definition</h2>
<div class="outline-text-2" id="text-1">
<p>
Let \(T: V\rightarrow V\) be an endomorphism (maps from a space to
itself) of a vector space \(V\). A vector \(v_0 \ne 0\) of \(V\) is an
eigenvector of \(T\) with respect to the <b>eigenvalue</b> \(\lambda\) if:
</p>

<p>
\[T(v_0)=\lambda v_0\]
</p>

<p>
The set of <b>eigenvalues</b> is called the spectre of \(T\). If \(\lambda \in
\ space(T)\) then the set:
</p>

<p>
\[V_{\lambda} = \{ v\in T\ |\ T(v)=\lambda v \}\]
</p>

<p>
is called <b>eigenspace</b>.
</p>

<p>
Notice that from the definition follows:
</p>

<p>
\[Tv_0 - \lambda v_0 = 0\]
\[(T - \lambda I)v_0 = 0\]
</p>

<p>
Therefore \((T-\lambda I)=0\) (is singular) and It's determinant
is 0.
</p>

<p>
\[det(T-\lambda I)=0\]
</p>

<p>
This is very useful to compute the eigenvalues. Once you have those,
and T, you can use them in the definition to get the eigenspace and
the eigenvectors.
</p>

<hr />

<p>
Travel: <a href="notes.html">Mathematics Notes</a>, <a href="../../theindex.html">Index</a>
</p>
</div>
</div>
]]></description>
</item>
<item>
<title>Probability Basics</title>
<link>https://giovanni-diary.netlify.app/programming/probability-basics.html</link>
<author>Giovanni Santini</author>
<pubDate>10 Jun 2025 00:00:00 GMT</pubDate>
<description><![CDATA[<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org5303342">1. Basic Definitions</a></li>
<li><a href="#org876d54b">2. Probability Function</a></li>
<li><a href="#org9e4e247">3. Bayes Theorem:</a></li>
<li><a href="#orga6b59a6">4. Stochastic Independence</a></li>
<li><a href="#orgf759d59">5. Distribution Function</a></li>
<li><a href="#org0bcfd7d">6. Random Variable</a></li>
<li><a href="#org127ff56">7. Notable Random Variables</a></li>
<li><a href="#org7e3ead4">8. Expected Value</a></li>
<li><a href="#orgae061bc">9. Variance</a></li>
<li><a href="#org4304e15">10. Covariance</a></li>
<li><a href="#org1709fe6">11. Standardization</a></li>
<li><a href="#org2b5f343">12. Markov Inequality</a></li>
<li><a href="#orga797005">13. Chebyshev Inequality</a></li>
</ul>
</div>
</div>
<p>
In this document I will summarize the core ideas of probability
theory.
</p>

<div id="outline-container-org5303342" class="outline-2">
<h2 id="org5303342"><span class="section-number-2">1.</span> Basic Definitions</h2>
<div class="outline-text-2" id="text-1">
<p>
There are two main interpretations of what probability is. The first
one is to think of a probability as the frequency of a certain event
occurring. If a coin has 0.5 probability of landing heads, then we
expect the coin to land heads about half of the time. The other
interpretation views probability as a quantity of uncertainty or
ignorance about something, this is more related to information rather
than repeated trials. In the coin example, here we mean that the
coin is equally likely to land heads or tails on the next toss.
</p>

<p>
We define the following terms:
</p>

<ul class="org-ul">
<li>\(\Omega\) as the sample space, It is composed of independent events</li>
<li>\(A\subset 2^{\Omega}\) is a subset of the sample space of a problem</li>
<li>\(a\in A\) is an event</li>
</ul>
</div>
</div>

<div id="outline-container-org876d54b" class="outline-2">
<h2 id="org876d54b"><span class="section-number-2">2.</span> Probability Function</h2>
<div class="outline-text-2" id="text-2">
<p>
A function \(P\) is a probability function if:
</p>

<ul class="org-ul">
<li>\(P\) is non negative: \(P(A)\ge 0\ \forall A\in \Omega\)</li>
<li>\(P\) is normalized: \(P(\Omega)=1\)</li>
<li><p>
\(P\) is \(\sigma\) -additive: if \(A_i \cap A_j \ne \emptyset,\ A\in \Omega\) then  \(P(\cup_i A_i)=\sum_i P(A_i)\)
</p>

<p>
From set theory, you can demonstrate that the following holds:
</p></li>
</ul>

<p>
\[P(A\cup B) = P(A) + P(B) - P(A\cap B)\]
</p>
</div>
</div>

<div id="outline-container-org9e4e247" class="outline-2">
<h2 id="org9e4e247"><span class="section-number-2">3.</span> Bayes Theorem:</h2>
<div class="outline-text-2" id="text-3">
<p>
Bayes theorem is a foundamental theorem that correlates the probabilty
of variables given another variable. First, we define \(P(A|H)\) as the
probability of A given H, and we can calculate this as:
</p>

<p>
\[P(A|H)=\frac{P(A\cap H)}{P(H)},\ P(H)>0\]
</p>

<p>
The Bayes theorem states:
</p>

<p>
\[P(A_i|B)=\frac{P(B|A_i)P(A_i)}{\sum_j P(B|A_j)P(A_j)}=\frac{P(B|A_i)P(A_i)}{P(B)}\]
</p>
</div>
</div>

<div id="outline-container-orga6b59a6" class="outline-2">
<h2 id="orga6b59a6"><span class="section-number-2">4.</span> Stochastic Independence</h2>
<div class="outline-text-2" id="text-4">
<p>
Events \(A\in \Omega\) are said to be independent if:
</p>

<p>
\[P(A_{i1} \cap A_{i2} \cap ... \cap A_{ik}) = \prod_{j=1}^k P(A_{ij}) = P(A_{i1})\cdot P(A_{i2})\cdot ...\cdot P(A_{ik})\]
</p>

<p>
The same applies to bivaraite functions:
</p>

<p>
\[P_{X, Y}(x, y) = P_X(x)\cdot P_Y(y),\ \forall (x, y)\in R_x \times R_y\]
</p>

<p>
moreover:
</p>

<p>
\[P_{X|Y}(x|y) = P_X(x)\]
\[P_{Y|X}(y|x) = P_Y(y)\]
</p>
</div>
</div>

<div id="outline-container-orgf759d59" class="outline-2">
<h2 id="orgf759d59"><span class="section-number-2">5.</span> Distribution Function</h2>
<div class="outline-text-2" id="text-5">
<p>
A function \(F\) is a probability distribution function if:
</p>

<ul class="org-ul">
<li>\(F\) never decreases</li>
<li>\(F\) is right-continuous</li>
<li>\(F\) always has a left-limit</li>
<li>\(\lim_{x\to - \infty} f(x)=0\)</li>
<li><p>
\(\lim_{x\to\infty}f(x)=1\)
</p>

<p>
Then \(P((a, b])=^{(discrete)}F(b)-F(a^-) =^{(continuous)} \int_a^b f(x)dx\)
</p></li>
</ul>

<p>
Where \(f(x)\) is called density when if \(F\in C^1\) in the continuous
formulation.
</p>
</div>
</div>

<div id="outline-container-org0bcfd7d" class="outline-2">
<h2 id="org0bcfd7d"><span class="section-number-2">6.</span> Random Variable</h2>
<div class="outline-text-2" id="text-6">
<p>
Random variables are a mathematical formalization used to model
quantities which depend on random events, It lets us quantify
random events so that we can make probability calculations.
</p>

<p>
More formally, a random variable is a function that maps event in
some sample space \(\Omega\) to a set of outcomes in measurable space \(E\),
which is often \(\mathbb{R}\).
</p>

<p>
\[X:\Omega \to E\]
</p>

<p>
The probability that \(X\) takes on a value in a measurable set
\(S\subseteq E\) is written as
</p>

<p>
\[P(X\in S) = P(\{ \omega \in \Omega \ |\ X(\omega)\in S \})\]
</p>
</div>
</div>

<div id="outline-container-org127ff56" class="outline-2">
<h2 id="org127ff56"><span class="section-number-2">7.</span> Notable Random Variables</h2>
<div class="outline-text-2" id="text-7">
<p>
Some random variables appear more than others, so a few of them
are worthy of their name. You will see those everywhere in nature,
economics, populations, and more.
</p>

<p>
Bernoulli:
</p>

<p>
\[X(\omega)=\{0, 1\}\]
</p>

<p>
Rademacher:
</p>

<p>
\[Y(\omega)=\{ -1, 1 \}\]
</p>

<p>
Binomial \(X\sim Bin(n, p)\):
</p>

<p>
\[P_x(J)=\{ \binom{n}{k}p^J(1-p)^{n-J},\ j=1...n\ |\ 0\ otherwise \}\]
</p>

<p>
Poissont \(X\sim Pois(\lambda)\):
</p>

<p>
\[P_x\{\frac{\lambda^xe^{-\lambda}}{x!}, n\in \mathbb{N}\cup \{ 0 \}\ |\ 0\ otherwise\}\]
</p>

<p>
Geometric:
</p>

<p>
\[P(y)=\{ p(1-p)^{y-1},\ y\in \mathbb{N}\ |\ 0\ otherwise \}\]
</p>

<p>
Uniform \(X\sim Unif[a, b]\):
</p>

<p>
\[f_x(x)=\{ \frac{1}{b-a},\ x\in [a, b]\ |\ 0\ otherwise \}\]
</p>

<p>
Normal (Gaussian) \(X\sim N(\mu , \sigma^2)\):
</p>

<p>
\[f_x(x) = \frac{1}{\sqrt{2\pi \sigma^2}}e^{-\frac{1}{2}\frac{(x-\mu)^2}{\sigma^2}}\]
</p>

<p>
Exponential \(X\sim Exp(\lambda)\):
</p>

<p>
\[f_x(x)=\lambda e^{\lambda x}\mathbb{1}(x>0)\]
</p>
</div>
</div>

<div id="outline-container-org7e3ead4" class="outline-2">
<h2 id="org7e3ead4"><span class="section-number-2">8.</span> Expected Value</h2>
<div class="outline-text-2" id="text-8">
<p>
We define the expected value in a discrete space as:
</p>

<p>
\[\mathbb{E}(x) = \sum_{x\in R_x} xp_x(x)\]
</p>

<p>
and in the continuous:
</p>

<p>
\[\mathbb{E}(x)=\int_{-\infty}^{\infty} xf_x(x)dx \]
</p>

<p>
The expected value is a linear function:
</p>

<p>
\[E(aX+b) = a\mathbb{E}(x)+b\]
\[E(g(x))=\sum_{x\in R_x} g(x)p_x(x)\]
</p>

<p>
Known formulas for notable random variables:
</p>

<ul class="org-ul">
<li>Bernoulli: \(\mathbb{E}(x)=p\)</li>
<li>Binomial: \(\mathbb{E}(x)=np\)</li>
<li>Geometric: \(\mathbb{E}(x)= \frac{1}{p}-1\)</li>
<li>Normal: \(\mathbb{E}(x)=\mu\)</li>
<li>Exponential: \(\mathbb{E}(x)=\frac{1}{\lambda}\)</li>
<li>Poisson: \(\mathbb{E}(x)=\lambda\)</li>
</ul>
</div>
</div>

<div id="outline-container-orgae061bc" class="outline-2">
<h2 id="orgae061bc"><span class="section-number-2">9.</span> Variance</h2>
<div class="outline-text-2" id="text-9">
<p>
We define variance as:
</p>

<p>
\[\mathbb{V}ar(x)=\mathbb{E}(x^2)-\mathbb{E}(x)^2 = \mathbb{E}[(x-\mathbb{E}[x])^2]\]
</p>

<p>
Moreover:
</p>

<p>
\[\mathbb{V}ar(x)=\mathbb{E}(\mathbb{V}ar(x|y)) + \mathbb{V}ar(\mathbb{E}(x|y))\]
</p>
</div>
</div>

<div id="outline-container-org4304e15" class="outline-2">
<h2 id="org4304e15"><span class="section-number-2">10.</span> Covariance</h2>
<div class="outline-text-2" id="text-10">
<p>
We define the covariance as:
</p>

<p>
\[\mathbb{C}ov(x, y)=\mathbb{E}((x-\mathbb{E}(x))(y-\mathbb{E}(y)))=\mathbb{E}(XY)-\mathbb{E}(x)\mathbb{E}(y)\]
</p>
</div>
</div>

<div id="outline-container-org1709fe6" class="outline-2">
<h2 id="org1709fe6"><span class="section-number-2">11.</span> Standardization</h2>
<div class="outline-text-2" id="text-11">
<p>
\[z=g(x)=\frac{x-\mathbb{E}(x)}{\sqrt{\mathbb{V}ar(x)}}\]
</p>

<p>
After this transformation:
</p>

<ul class="org-ul">
<li>\(\mathbb{E}(z)=0\)</li>
<li>\(\mathbb{V}ar(z)=1\)</li>
</ul>

<p>
The opposite can be achieved:
</p>

<p>
\[x=\sigma z + \mu\]
</p>
</div>
</div>

<div id="outline-container-org2b5f343" class="outline-2">
<h2 id="org2b5f343"><span class="section-number-2">12.</span> Markov Inequality</h2>
<div class="outline-text-2" id="text-12">
<p>
Let \(Y\) be a random variable non negative, then \(\forall a>0\):
</p>

<p>
\[P(Y\ge a)\le \frac{\mathbb{E}(y)}{a}\]
</p>
</div>
</div>

<div id="outline-container-orga797005" class="outline-2">
<h2 id="orga797005"><span class="section-number-2">13.</span> Chebyshev Inequality</h2>
<div class="outline-text-2" id="text-13">
<p>
Let \(Y\) be a random variable, \(\mu = \mathbb{E}(y)\),
\(\sigma^2=\mathbb{V}ar(y)\), then \(\forall \epsilon > 0\):
</p>

<p>
\[P(|Y-\mu| \ge \epsilon)\le \frac{\sigma^2}{\epsilon^2}\]
</p>

<hr />

<p>
Travel: <a href="notes.html">Mathematics Notes</a>, <a href="../../theindex.html">Index</a>
</p>
</div>
</div>
]]></description>
</item>
<item>
<title>The Lagrange dual function</title>
<link>https://giovanni-diary.netlify.app/programming/the-lagrange-dual-function.html</link>
<author>Giovanni Santini</author>
<pubDate>10 Jun 2025 00:00:00 GMT</pubDate>
<description><![CDATA[<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org985ca33">1. Index</a></li>
<li><a href="#orgcad6301">2. Optimization problems</a></li>
<li><a href="#org256df98">3. The Lagrangian</a></li>
<li><a href="#org4cba2af">4. The dual problem</a></li>
<li><a href="#org84e8fc1">5. Convex optimization problems</a></li>
</ul>
</div>
</div>
<p>
In this post we will delve into the realm of optimization and in
particular we will look at the Lagrange dual function. I will be
using the book "Convex Optimization" by Stephen Boyd and Lieven
Vandenberghe as my reference.
</p>

<div id="outline-container-org985ca33" class="outline-2">
<h2 id="org985ca33"><span class="section-number-2">1.</span> Index</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>Optimization problems</li>
<li>The Lagrangian</li>
<li>The dual problem</li>
<li>Convex optimization problems</li>
</ul>
</div>
</div>

<div id="outline-container-orgcad6301" class="outline-2">
<h2 id="orgcad6301"><span class="section-number-2">2.</span> Optimization problems</h2>
<div class="outline-text-2" id="text-2">
<p>
A mathematical optimization problem, or just optimization problem, has
the form:
</p>

<p>
\[minimize\ f_0(x)\]
</p>

<p>
subject to:
</p>

<p>
\[f_i(x)\le b_i,\ i=1, ..., m\]
\[h_i(x) = 0,\ i=1, ..., p\]
</p>

<p>
Here the vector \(x=(x_1, ..., x_n)\) is the optimization variable of
the problem, the function \(f_0: \mathbb{R}^n \rightarrow \mathbb{R}\)
is the objective function, the functions \(f_i, h_i: \mathbb{R}^n \rightarrow
\mathbb{R},\ i=1, ..., m\) are the constraint functions, and the
constants \(b_i, ..., b_m\) are the limits, or bounds, of the
constraints. A vector \(x*\) is called optimal, or a solution of the
problem, if It has the smallest objective value among all vectors that
satisfy the constraints.
</p>

<p>
The optimal value \(x*\) of the above problem, also referred to as \(p*\),
is defined as:
</p>

<p>
\[x* = inf\{ f_0(x) | f_i(x) \le 0,\ i=1, ..., m,\ h_i(x)=0,\ i=1,
..., p \}\]
</p>

<p>
The optimal value for a maximization problem would be the greater
value instead.
</p>

<p>
The types of optimization problems can be divided into:
</p>

<ul class="org-ul">
<li><b>linear programming</b> where the objective and all constraint
functions are linear meaning they satisfy the equality \(f_i(\alpha
  x+ \beta y) = \alpha f(x) + \beta f(y)\) for all \(x, y \in
  \mathbb{R}^n\) and all \(\alpha, \beta \in \mathbb{R}\). There is no
simple analytical formula for the solution of a linear program, but
there are a variety of very effective methods including Dantzig's
simplex method and interior-point methods.</li>

<li><b>convex optimization</b> where the objective and constraint functions
are convex meaning they satisfy the equation \(f_i(\alpha x+ \beta y)
  \le \alpha f(x) + \beta f(y)\) for all \(x, y \in \mathbb{R}^n\) and
all \(\alpha , \beta \in \mathbb{R},\ \alpha + \beta = 1, \alpha \ge
  0, \beta \ge 0\). We say a function \(f\) is <b>concave</b> if \(-f\) is
convex. If just the objective function is convex but not the
constraints, the problem is called <b>quasiconvex</b>. Similar to linear
programming, in general there is no analytical formula for solving
these problems, but there are effective methods to do so like
interior-point methods. Fortunately, those are quite efficient for
computers and we are able to solve them quickly.</li>

<li><b>non linear optimization</b> for problems with non linear objective or
constraints which further divides into <b>local</b> optimization (finding
a local best solution) or <b>global</b> optimization which is usually
slower in terms of computation time. There is no general efficient
solution.</li>
</ul>
</div>
</div>

<div id="outline-container-org256df98" class="outline-2">
<h2 id="org256df98"><span class="section-number-2">3.</span> The Lagrangian</h2>
<div class="outline-text-2" id="text-3">
<p>
Consider a minimization problem as defined above, we assume the domain
\(D=\prod_{i=1}^m dom(f_i) \cap \prod_{i=1}^p dom(h_i)\) is non empty
and denote the optimal value by \(p*\).
</p>

<p>
The idea is to account for the constraints by augmenting the objective
function with a weighted sum of the constraints. We define the
<b>Lagrangian</b> \(L:\ \mathbb{R}^n \times \mathbb{R}^m \times \mathbb{R}^p
\rightarrow \mathbb{R}\) as:
</p>

<p>
\[L(x, \lambda, \nu) = f_0(x) + \sum_{i=1}^m \lambda_i f_i(x) +
\sum_{i=1}^p \nu_i h_i(x)\]
</p>

<p>
We refer to \(\lambda_i\) as the <b>Lagrange multiplier</b> associated with the
i-th inequality constraint \(f_i\le 0\) and \(\nu_i\) as the Lagrange
multiplier associated with the i-th equality constraint \(h_i(x)=0\). The
vectors \(\lambda\) and \(\nu\) are called the dual variables or Lagrange
multiplier vectors associated with the problem.
</p>

<p>
We define the <b>Lagrange dual function</b> \(g: \mathbb{R}^m \times
\mathbb{R}^p \rightarrow \mathbb{R}\) as the minimum value of the
Lagrangian over \(x\) associated to the previous problem: for \(\lambda
\in \mathbb{R}^n,\ \nu \in \mathbb{R}^p\),
</p>

<p>
\[g(\lambda , \nu) = inf_{x\in D} L(x, \lambda , \nu ) = inf_{x\in
D}(f_0(x) + \sum_{i=1}^m \lambda_i f_i(x) + \sum_{i=1}^p \nu_i
h_i(x))\]
</p>

<p>
It is easy to see that \(g(\lambda , \nu)\) is the lower bound of the
optimal value \(p*\), in fact the sum of \(f_i(x)\) is negative and the
sum of \(h_i(x)\) is zero for valid solutions, hence we are subtracting
from \(f_0(x)\) and we are looking for the vectors \(\lambda\) and \(\nu\)
that give the smaller valid value (or the greater subtraction), which
is the lower bound.
</p>
</div>
</div>

<div id="outline-container-org4cba2af" class="outline-2">
<h2 id="org4cba2af"><span class="section-number-2">4.</span> The dual problem</h2>
<div class="outline-text-2" id="text-4">
<p>
We showed that \(g(\lambda , \nu)\) is the lower bound of the optimal
value \(p*\). But to find the optimal value we need to find the highest
lower bound. Hence, we need to maximize the dual function, meaning we need
to solve the problem:
</p>

<p>
\[maximize g(\lambda , \nu)\]
</p>

<p>
subject to:
</p>

<p>
\[\lambda \ge 0\]
</p>

<p>
This problem is called the Lagrange dual problem associated with the
original minimization problem. We refer to \((\lambda *, \nu *)\) as
dual optimal or optimal Lagrange multipliers if they are optimal for
the problem.
</p>

<p>
The Lagrange dual problem is a <b>convex optimization problem</b>, since
the objective to be maximized is concave (because "the dual function
is the point-wise infium of a family of affine functions", gl) and the
constraint is convex (indeed the constraint \(f(x) < \lambda_i\) has
function \(f(x)=0\) which satisfies the definition of convex).  This is
always the case whether or not the original problem (sometimes referred
to as primal problem) is convex.
</p>
</div>
</div>

<div id="outline-container-org84e8fc1" class="outline-2">
<h2 id="org84e8fc1"><span class="section-number-2">5.</span> Convex optimization problems</h2>
<div class="outline-text-2" id="text-5">
<p>
Let's now consider convex optimization problems. A fundamental
property of convex optimization problems is that any locally optimal
point is also globally optimal, this can be proven my contradiction.
</p>

<p>
The convex optimization problem is called a quadratic program if the
objective function is convex and quadratic, and the constraint
functions are affine (linear). A quadratic program can be expressed in
the form:
</p>

<p>
\[minimize\ \frac{1}{2}x^TPx + q^Tx+r\]
</p>

<p>
subject to:
</p>

<p>
\[Gx \le h\]
\[Ax=b\]
</p>

<p>
where \(P\) is a symmetric positive matrix where \(x^TPx\) is always
positive.
</p>

<p>
There are many techniques to solve these kind of problems. If the
problem is unconstrained, you can use backtracking (move in steps and
reduce the step size incrementally), <a href="../notes/ml/06-gradient-descent.html">gradient descent</a>, steepest
descent or newton's method. If It is also very simple, you can
calculate the first and second derivatives and equal them to 0. In
equality constrained problems you can use more sophisticated versions
of the Newton step or using barriers.  In general, you can use the
interior-point method.
</p>

<p>
Explaining those falls outside of the scope of this blog, you can
dig deeper if you want. I think gradient descent is the easier to
understand and you can find my notes <a href="../notes/ml/06-gradient-descent.html">here</a>.
</p>

<p>
What we talked about here is used in practice in various areas, such
as <a href="../notes/ml/07-support-vector-machines.html">machine learning</a>.
</p>

<hr />

<p>
Travel: <a href="notes.html">Mathematics Notes</a>, <a href="../../theindex.html">Index</a>
</p>
</div>
</div>
]]></description>
</item>
<item>
<title>Contributing to Openstreetmap</title>
<link>https://giovanni-diary.netlify.app/programming/contributing-to-openstreetmap.html</link>
<author>Giovanni Santini</author>
<pubDate>01 May 2025 00:00:00 GMT</pubDate>
<description><![CDATA[<p>
Lately I have been contributing to <a href="https://www.openstreetmap.org">Openstreetmap</a> and I am really
enjoying it.
</p>

<p>
Openstreetmap is a shared effort to map the entire globe, leaded by
individual contributors worldwide, in a free and transparent way.  You
can browse the map on the openstreetmap website and edit it directly
via the web editor after making an account. What you notice after a
while is that each item, each area, each bench or tree was placed
there by someone, and one bench after the other people created a
complete map of the world.
</p>

<p>
I find this fascinating because when I am out contributing to the map
I feel like I am documenting a certain place in time, like taking a
snapshot of it. I know my contribution to the map is only temporary:
shops will close, streets get changed, benches are moved. Still, what
I care the most is how the place looks like now that I am in it, even
if It is not forever, and I want to keep a record of it. You could
compare the map now with the map in 50 years and see how much It
changed, little by little; people in the future will have a more
detailed picture of a place in the past.
</p>

<p>
Contributing to the map is really easy, the editor is intuitive and
there is a tutorial which I encourage you do to. Moreover, there are
many android apps like <a href="https://f-droid.org/en/packages/de.westnordost.streetcomplete/">StreetComplete</a> which gamify the process and
renders It more accessible even for casual users without much effort.
</p>

<p>
StreetComplete will show you missing data in the map near your
location, and you can contribute by answering simple questions like
"Is there a traffic island in this crosswalk?" or "Are there lights
in this street?". Most of the time you can answer yes or no, you
could also fill the opening hours of shops or double check that some
places still exists. Overall, this is a very easy app for casual
users who want to contribute to Openstreetmap.
</p>


<div id="org581b4d2" class="figure">
<p><img src="../../ephemeris/images/streetcomplete-map.jpeg" alt="streetcomplete-map.jpeg" width="600px" align="center" />
</p>
<p><span class="figure-number">Figure 1: </span>Map view in StreetComplete</p>
</div>

<p>
Another big group that documents knowledge is Wikimedia, which manages
things like Wikipedia, you might have heard of this.  There is a big
community around It, with local communities on many countries and
regions to make information available to everyone freely. Similarly,
there are local communities for Openstreetmap.
</p>

<p>
I think the existence of those project is really important and I am
really grateful to all the people that have contributed to It. I
wish those project to strive and be present and relevant. I'll give
my part, even if in small amount, and maybe even inspire other
like-minded people to do the same.
</p>

<hr />

<p>
Travel: <a href="../programming.html">Programming</a>, <a href="../../theindex.html">Index</a>
</p>
]]></description>
</item>
<item>
<title>How to root a Samsung Galaxy J5 (2016)</title>
<link>https://giovanni-diary.netlify.app/programming/root-a-samsung-galaxy-j5.html</link>
<author>Giovanni Santini</author>
<pubDate>01 May 2025 00:00:00 GMT</pubDate>
<description><![CDATA[<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org304bf1e">1. Index</a></li>
<li><a href="#orgd06d99e">2. The process</a></li>
<li><a href="#orgca53d7a">3. 1. Boot a custom recovery image</a></li>
<li><a href="#org6ea88d3">4. 2. Install a special application</a></li>
<li><a href="#org2f54df4">5. 3. Enjoy the power</a></li>
<li><a href="#org16ce75b">6. Installing an alternative OS</a></li>
</ul>
</div>
</div>
<div id="outline-container-org304bf1e" class="outline-2">
<h2 id="org304bf1e"><span class="section-number-2">1.</span> Index</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>The processes</li>
<li>1. Boot a custom recovery image</li>
<li>2. Install a special applications</li>
<li>3. Enjoy the power</li>
<li>Installing an alternative OS</li>
</ul>

<p>
Rooting android your first time is a frustrating experience at best.
It took me more than necessary to get root privileges on my phone,
therefore I am writing a quick guide for my future self when he will
need my assistance. This document explains the steps I took to
successfully root my android phone.
</p>

<p>
Note that the process may vary in several ways, mainly depending on
the model of the phone you are trying to root. This guide is written
specifically for the Samsung Galaxy J5 (2016), however most of the
steps should be similar hopefully. It is advised to read this article
first before attempting to root your phone.
</p>
</div>
</div>

<div id="outline-container-orgd06d99e" class="outline-2">
<h2 id="orgd06d99e"><span class="section-number-2">2.</span> The process</h2>
<div class="outline-text-2" id="text-2">
<p>
To root a phone we need something else with root privileges to grant
us the same status. Of course, stock Android will never let us get
even a glimpse of this power for security reasons so we need to find a
workaround.  The solution is to boot a custom recovery image, which has
high privileges, to install some applications with root status. We
can leverage this to install a special app that gives permissions to
other apps during normal system execution.
</p>

<p>
To recap, we need to do the following to achieve root:
</p>
<ol class="org-ol">
<li>Boot a custom recovery image</li>
<li>Install a special application</li>
<li>Enjoy the power</li>
</ol>

<p>
Note that you might mess things up and lose all your data, so be
prepared.  Probably you will also lose your device's warranty.
</p>

<p>
You have been warned :-)
</p>
</div>
</div>

<div id="outline-container-orgca53d7a" class="outline-2">
<h2 id="orgca53d7a"><span class="section-number-2">3.</span> 1. Boot a custom recovery image</h2>
<div class="outline-text-2" id="text-3">
<p>
We need to download a custom recovery image for your phone model.
There are many cool looking alternatives, I used TWRP and It can be
downloaded from the official website. Note that you need to choose the
right version based on your phone.  I downloaded the <code>.img</code> file,
compressed it in a tar archive and renamed it <code>recovery.tar</code>.
</p>

<div class="org-src-container">
<pre class="src src-bash">wget https://.../something.img
tar -cf something.tar something.img
mv something.img recovery.zip
</pre>
</div>

<p>
Now we need to put this into our device. We need to boot into download
mode which on my smartphone is <code>VOL_DOWN + HOME + POWER</code>. After this
we can interact with the device, I used <code>odin4</code> (linux version) for
this. To check that oding can talk to the device, run <code>odin4 -l</code> and
expect some output. If it does not show anything I cannot help you, It
is probably a driver problem, good luck, I believe in you, trust in
yourself, you are strong. If you get some permission error, you need
to set something on your udev, just follow closely the help output
and you should be good to go.
</p>

<p>
Then load the recovery mode with <code>odin4 -a recovery.zip</code> and,
IMMEDIATELY after it finishes, you need to boot in recovery mode,
which on my phone is done via <code>VOL_UP + HOME + POWER</code>. You need to be
QUICK, REALLY QUICK!!! Keep trying until you manage to do this. If
everything was successful, you are now greeted with a cool recovery
program.
</p>
</div>
</div>

<div id="outline-container-org6ea88d3" class="outline-2">
<h2 id="org6ea88d3"><span class="section-number-2">4.</span> 2. Install a special application</h2>
<div class="outline-text-2" id="text-4">
<p>
We now need to install something that will make other things root. We
can use Magisk, you can download the apk from the official github
releases and rename it to a <code>.zip</code> file. We need to send It to the
device and we will use <code>adb</code> from the official platform tools. Just
extract the archive.
</p>

<p>
On the device, select <code>advanced -&gt; sideload -&gt; swipe to start
sideload</code>.  On your pc, run <code>adb sideload app-release.zip</code>, this
should install magisk and it should show the installation on the
phone. After this finishes, reboot your phone, go to your apps and
open Magisk, It may ask to be installed again, just say yes, follow
the installation instructions (just tap two buttons), maybe close it
and reopen it, reboot and&#x2026;  we are root!
</p>

<p>
You can check this by installing RootChecker.
</p>
</div>
</div>

<div id="outline-container-org2f54df4" class="outline-2">
<h2 id="org2f54df4"><span class="section-number-2">5.</span> 3. Enjoy the power</h2>
<div class="outline-text-2" id="text-5">
<p>
Now that you are root you can do a bunch of cool things like wipe out
everything and install gentoo. A more useful thing would be to install
an adblocker (I'd suggest <code>adAway</code>) so that you can actually read blogs
and news in peace.
</p>
</div>
</div>

<div id="outline-container-org16ce75b" class="outline-2">
<h2 id="org16ce75b"><span class="section-number-2">6.</span> Installing an alternative OS</h2>
<div class="outline-text-2" id="text-6">
<p>
There are plenty of alternatives and variations of Android out there,
the only constraint is that they need to support your phone.  You
could theoretically make your own build but I have no idea how you
would resolve drivers. I aplogize for my ignorance, you'll have to
figure It out some day.  I found <a href="https://community.e.foundation/t/unofficial-builds-samsung-galaxy-j5-series-for-e-os-r/56461/3">this</a> unofficial build of /e/OS,
hopefully the link still works.
</p>

<p>
After you have installed the custom recovery media, you can start the
sideload just as you did for Makisk in the previous section, and load
the downloaded archive. That is really it, you should have a working
OS.  If the process fails and you cannot boot the OS correctly, you
should be able to access the recovery mode on startup assuming that
you can turn off your device. In my experience, when the boot broke, I
could not power It off so I just removed the battery and
rebooted. Unfortunately, you cannot do this in new phones (sight), so
you may try to make It discharge until ti powerd off, gook luck.
</p>

<hr />

<p>
Travel: <a href="../programming.html">Programming</a>, <a href="../../theindex.html">Index</a>
</p>
</div>
</div>
]]></description>
</item>
<item>
<title>Setting up a Minecraft server</title>
<link>https://giovanni-diary.netlify.app/programming/notes/setting-up-a-minecraft-server.html</link>
<author>Giovanni Santini</author>
<pubDate>29 May 2025 00:00:00 GMT</pubDate>
<description><![CDATA[<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org16c7c15">1. Vanilla server</a></li>
<li><a href="#orgc91f4b0">2. PaperMC</a></li>
</ul>
</div>
</div>
<p>
In this page I want to quickly explain how to setup a minecraft
server. You can follow this document regardless of your platform
since you only need the java virtual machine to run the server.
</p>

<div id="outline-container-org16c7c15" class="outline-2">
<h2 id="org16c7c15"><span class="section-number-2">1.</span> Vanilla server</h2>
<div class="outline-text-2" id="text-1">
<p>
Setting up a vanilla server is very simple, just download the jar file
from the <a href="https://www.minecraft.net/en-us/download/server">Mojang</a> website and move It on Its own directory (it will
generate a bunch of garbage) and run it using the JVM:
</p>

<div class="org-src-container">
<pre class="src src-bash">java -Xmx1024M -Xms1024M -jar server.jar nogui 
</pre>
</div>

<p>
You can set many flags to fine tune various aspects of the server
such as how much resources does it use and multi threading. You can
find some information <a href="https://docs.papermc.io/paper/aikars-flags/">here</a>.
</p>

<p>
The first time you run the server, It will fail with error "Failed to
load eula.txt". You are required to accept the eula agreement which
you can find <a href="https://www.minecraft.net/en-us/eula">here</a>. If you want to proceed, you should edit a file
named "eula.txt" in the same directory as the .jar file and set the
"eula" value to true.
</p>

<pre class="example">
eula=true
</pre>

<p>
Then run the server again and you should see a message saying
"Starting Minecraft server on *:25565" and the world being generated.
Congratulations, you have your vanilla minecraft server. You can
connect to the server via the IP of the machine in the network.
</p>

<p>
Note that if you have a firewall, you need to check that the port is
accessible from other machines. If you need the server to be reachable
from other networks, you need to configure port forwarding on your
router or use a VPN.
</p>
</div>
</div>

<div id="outline-container-orgc91f4b0" class="outline-2">
<h2 id="orgc91f4b0"><span class="section-number-2">2.</span> PaperMC</h2>
<div class="outline-text-2" id="text-2">
<p>
<a href="https://docs.papermc.io/">PaperMC</a> is a popular server that enables the use of plugins. The
experience is very similar to the vanilla server but you also get
to configure all the plugins.
</p>

<p>
You can download paper from the official website and run it with
the JVM:
</p>

<div class="org-src-container">
<pre class="src src-bash">java -Xmx1024M -Xms1024M -jar paper-1.21.4-231.jar nogui
</pre>
</div>

<p>
As always, you will need to edit the eula file that will be generated
after the first run.
</p>

<p>
You can browse and download plugins in the <a href="https://hangar.papermc.io/">Hangar</a> website, then
move them in the "plugin" directory in your server's directory.
</p>

<hr />

<p>
Travel: <a href="notes.html">Programming Notes</a>, <a href="../../theindex.html">Index</a>
</p>
</div>
</div>
]]></description>
</item>
<item>
<title>Setting up an IRC client</title>
<link>https://giovanni-diary.netlify.app/programming/notes/setting-up-an-IRC-client.html</link>
<author>Giovanni Santini</author>
<pubDate>02 Jun 2025 00:00:00 GMT</pubDate>
<description><![CDATA[<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org4c05758">1. Bouncer</a></li>
<li><a href="#org49366a9">2. Clients</a></li>
</ul>
</div>
</div>
<p>
I have been playing with IRC lately. In this note I will explain how
to setup your client to connect to an IRC server just in case I need
to do It again, nothing difficult or impressive really.
</p>

<div id="outline-container-org4c05758" class="outline-2">
<h2 id="org4c05758"><span class="section-number-2">1.</span> Bouncer</h2>
<div class="outline-text-2" id="text-1">
<p>
You want to have a bouncer running on your network, this is needed
because when you close any IRC client you will loose all the messages.
What a bouncer does is connecting to any IRC server for you, then you
will connect to the bouncer instead of connecting directly to the IRC
server. As long as the bouncer is live somewhere in your network, you
won't loose messages and you can connect via different client and
devices to the same bouncer.
</p>

<p>
You can use <a href="https://wiki.znc.in/ZNC">ZNC</a> as a bouncer, It is already packaged in many
distributions. On fedora, It is as easy as running:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo dnf install znc
</pre>
</div>

<p>
Fedora will also setup the systemd daemon that you can enable if
you want. In order to setup the bouncer, run:
</p>

<div class="org-src-container">
<pre class="src src-bash">znc --makeconf
</pre>
</div>

<p>
This will prompt you a few settings. I will configure so that It will
connect to libera and disable ssl because It gave me problems.
</p>

<pre class="example">
$ znc --makeconf

[ .. ] Checking for list of available modules...
[ ** ]
[ ** ] -- Global settings --
[ ** ]
[ ?? ] Listen on port (1025 to 65534): 1025
[ ?? ] Listen using SSL (yes/no) [no]: no
[ ?? ] Listen using both IPv4 and IPv6 (yes/no) [yes]: no
[ .. ] Verifying the listener...
[ ** ] Unable to locate pem file: [/home/santo/.znc/znc.pem], creating it
[ .. ] Writing Pem file [/home/santo/.znc/znc.pem]...
[ ** ] Enabled global modules [webadmin]
[ ** ]
[ ** ] -- Admin user settings --
[ ** ]
[ ?? ] Username (alphanumeric): santo_
[ ?? ] Enter password:
[ ?? ] Confirm password:
[ ?? ] Nick [santo_]:
[ ?? ] Alternate nick [santo__]:
[ ?? ] Ident [santo_]:
[ ?? ] Real name (optional):
[ ?? ] Bind host (optional):
[ ** ] Enabled user modules [chansaver, controlpanel]
[ ** ]
[ ?? ] Set up a network? (yes/no) [yes]: yes
[ ** ]
[ ** ] -- Network settings --
[ ** ]
[ ?? ] Name [libera]: libera
[ ?? ] Server host (host only): irc.libera.chat
[ ?? ] Server uses SSL? (yes/no) [no]: no
[ ?? ] Server port (1 to 65535) [6697]:
[ ?? ] Server password (probably empty):
[ ?? ] Initial channels: #linux
[ ** ] Enabled network modules [simple_away]
[ ** ]
[ .. ] Writing config [/home/santo/.znc/configs/znc.conf]...
[ ** ]
[ ** ] To connect to this ZNC you need to connect to it as your IRC server
[ ** ] using the port that you supplied.  You have to supply your login info
[ ** ] as the IRC server password like this: user/network:pass.
[ ** ]
[ ** ] Try something like this in your IRC client...
[ ** ] /server &lt;znc_server_ip&gt; +1025 santo_:&lt;pass&gt;
[ ** ]
[ ** ] To manage settings, users and networks, point your web browser to
[ ** ] https://&lt;znc_server_ip&gt;:1025/
[ ** ]
[ ?? ] Launch ZNC now? (yes/no) [yes]: no
</pre>

<p>
You can finally run ZNC by running the command <code>znc</code>, <code>znc --debug</code>
or via the systemd daemon. Check that you do not have firewall
rules that may block binds to the port.
</p>

<p>
Additionally, you can accesses an admin panel via http, as the
output of makeconf suggested.
</p>

<pre class="example">
https://&lt;znc_server_ip&gt;:1025/
</pre>
</div>
</div>

<div id="outline-container-org49366a9" class="outline-2">
<h2 id="org49366a9"><span class="section-number-2">2.</span> Clients</h2>
<div class="outline-text-2" id="text-2">
<p>
There are as many IRC clients as you want. Now I use <a href="https://weechat.org/">weechat</a> which is
tui based, It is probably already packaged by your distribution.
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo dnf install weechat
</pre>
</div>

<p>
Once you run weechat, you can connect to your server by first
adding a server and connecting to it:
</p>

<pre class="example">
/server add local localhost/1025
/connect local -username=santo_ -password=my-password
</pre>

<p>
You should see a buffer opening with a welcome message. If this is not
the case, something went wrong. If you get the message "this nickname
is registered. Please choose a different nickanme" you either are
already registered with that nickname and you should login with <code>/mng
NickServ IDENTIFY username password</code>, or someone already registered
that nickname and you need to change it. In this case, you can
directly edit the ZNC config file in <code>~/.znc/configs/znc.conf</code> and
restart the server with a different nickname.
</p>

<p>
To join a channel use the <code>join</code> command:
</p>

<pre class="example">
/join #&lt;channel-name&gt;
</pre>


<p>
A useful command in weechat is to enable mouse support:
</p>

<pre class="example">
/mouse enable
</pre>


<hr />

<p>
Travel: <a href="notes.html">Programming Notes</a>, <a href="../../theindex.html">Index</a>
</p>
</div>
</div>
]]></description>
</item>
</channel></rss>